<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>BitcoinBook.dev</title><style>
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	text-indent: -1.7em;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, YuMincho, "Yu Mincho", "Hiragino Mincho ProN", "Hiragino Mincho Pro", "Songti TC", "Songti SC", "SimSun", "Nanum Myeongjo", NanumMyeongjo, Batang, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC', 'Noto Sans CJK KR'; }

.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC', 'Noto Sans Mono CJK KR'; }

.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, YuMincho, "Yu Mincho", "Hiragino Mincho ProN", "Hiragino Mincho Pro", "Songti TC", "Songti SC", "SimSun", "Nanum Myeongjo", NanumMyeongjo, Batang, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC', 'Noto Sans CJK KR'; }

.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC', 'Noto Sans Mono CJK KR'; }

.highlight-default {
}
.highlight-gray {
	color: rgb(155,154,151);
}
.highlight-brown {
	color: rgb(100,71,58);
}
.highlight-orange {
	color: rgb(217,115,13);
}
.highlight-yellow {
	color: rgb(223,171,1);
}
.highlight-teal {
	color: rgb(15,123,108);
}
.highlight-blue {
	color: rgb(11,110,153);
}
.highlight-purple {
	color: rgb(105,64,165);
}
.highlight-pink {
	color: rgb(173,26,114);
}
.highlight-red {
	color: rgb(224,62,62);
}
.highlight-gray_background {
	background: rgb(235,236,237);
}
.highlight-brown_background {
	background: rgb(233,229,227);
}
.highlight-orange_background {
	background: rgb(250,235,221);
}
.highlight-yellow_background {
	background: rgb(251,243,219);
}
.highlight-teal_background {
	background: rgb(221,237,234);
}
.highlight-blue_background {
	background: rgb(221,235,241);
}
.highlight-purple_background {
	background: rgb(234,228,242);
}
.highlight-pink_background {
	background: rgb(244,223,235);
}
.highlight-red_background {
	background: rgb(251,228,228);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(55, 53, 47, 0.6);
	fill: rgba(55, 53, 47, 0.6);
}
.block-color-brown {
	color: rgb(100,71,58);
	fill: rgb(100,71,58);
}
.block-color-orange {
	color: rgb(217,115,13);
	fill: rgb(217,115,13);
}
.block-color-yellow {
	color: rgb(223,171,1);
	fill: rgb(223,171,1);
}
.block-color-teal {
	color: rgb(15,123,108);
	fill: rgb(15,123,108);
}
.block-color-blue {
	color: rgb(11,110,153);
	fill: rgb(11,110,153);
}
.block-color-purple {
	color: rgb(105,64,165);
	fill: rgb(105,64,165);
}
.block-color-pink {
	color: rgb(173,26,114);
	fill: rgb(173,26,114);
}
.block-color-red {
	color: rgb(224,62,62);
	fill: rgb(224,62,62);
}
.block-color-gray_background {
	background: rgb(235,236,237);
}
.block-color-brown_background {
	background: rgb(233,229,227);
}
.block-color-orange_background {
	background: rgb(250,235,221);
}
.block-color-yellow_background {
	background: rgb(251,243,219);
}
.block-color-teal_background {
	background: rgb(221,237,234);
}
.block-color-blue_background {
	background: rgb(221,235,241);
}
.block-color-purple_background {
	background: rgb(234,228,242);
}
.block-color-pink_background {
	background: rgb(244,223,235);
}
.block-color-red_background {
	background: rgb(251,228,228);
}
.select-value-color-default { background-color: rgba(206,205,202,0.5); }
.select-value-color-gray { background-color: rgba(155,154,151, 0.4); }
.select-value-color-brown { background-color: rgba(140,46,0,0.2); }
.select-value-color-orange { background-color: rgba(245,93,0,0.2); }
.select-value-color-yellow { background-color: rgba(233,168,0,0.2); }
.select-value-color-green { background-color: rgba(0,135,107,0.2); }
.select-value-color-blue { background-color: rgba(0,120,223,0.2); }
.select-value-color-purple { background-color: rgba(103,36,222,0.2); }
.select-value-color-pink { background-color: rgba(221,0,129,0.2); }
.select-value-color-red { background-color: rgba(255,0,26,0.2); }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="49c06c0f-2185-4664-b62f-48ef9e9d514d" class="page sans"><header><div class="page-header-icon undefined"><img class="icon" src="favicon.ico"/></div><h1 class="page-title">BitcoinBook.dev</h1></header><div class="page-body"><p id="d35e0aea-889d-4fa9-9a5b-aa5d48c15248" class="">Welcome!</p><p id="a9505598-8d11-475e-ac3d-a8953031a7cd" class="">
</p><p id="35d722c9-ae41-4f56-9af5-00bf0dc88f57" class="">BitcoinBook.dev started as a list of hyperlinks, notes, and text I found to be useful while learning about Bitcoin.</p><p id="64848a0d-0189-483c-9068-19158a8312bc" class="">This project is open-source and contributions are highly encouraged.</p><p id="9c2b9ee7-4a09-43d8-8d4c-f11247a84a3d" class="">If you find any mistakes, <a href="https://github.com/philipglazman/bitcoinnotes/issues/new">open an Issue on Github</a>.</p><p id="ed812344-4feb-4bba-950a-f4a6b082f03c" class="">
</p><nav id="4420c802-d365-4eb4-9963-5084355b4225" class="block-color-gray table_of_contents"><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#c69099a2-1292-4a37-b4da-aae0fe1331f1">Introduction</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#27e73f89-d634-4e34-a3f5-1b471ca32b1d">Protocol</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#0503f734-82d6-4f6e-95d0-b5502d23a53f">Primitives</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#7e7ad24d-5a7c-4620-9e86-38227eecf4e9">Hashes</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#0688a0f9-3fb6-41f6-afc7-048e21d417f1">Merkle Trees</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#0974d88e-6e3c-4d16-a2f4-6587fdd5c9dc">Signatures</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#5a01119a-08fb-4dd9-8395-2ade3bb8725a">Addresses</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#eb0453fc-d5cd-4ba9-99a4-d0379c76aaa6">Transactions</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#b41b852c-3908-4de2-a9bb-e9f88887dcfa">Blocks</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#06ca2726-6c89-4828-93a8-aebfdd643bc5">Consensus</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#90053964-efd7-495a-86ad-05b061da5c86">Script</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#b06eb81f-df34-4239-8610-f6d4e81118da">Segregated Witness</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#eef05ced-749c-4959-96ae-4012b5bd3a32">Taproot/Schnorr</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#2846bee3-b198-4fb7-99e8-25a1b2cef2b4">Introduction</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#8489fc23-d7fa-4c5d-8f3b-21ca0d2910e6">BIP340</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#463570d2-24f1-4ac7-9d7e-e2ea8d974509">BIP341</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#70fa74b2-bb61-4e8a-b899-b5a3edbd253f">BIP342</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#8d8e02e3-2282-4166-8db7-6d87edc61db6">MuSig</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#513ed7dd-7801-4402-a6d9-59771727a562">SIGHASH_ANYPREVOUT</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#b44f0e97-68bd-4b14-b470-3994b0fed56a">Mining</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#71c6ee36-69b2-4068-b86c-6dca87668230">Introduction</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#6b1e788a-a4ec-49c3-b548-679b0c4778bd">GetBlockTemplate</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#66efa13c-3a79-4e4b-b975-b902ef2ef296">Stratum</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#a8ca697d-b8fd-4425-87af-904f1515ca51">StratumV2</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#083f1957-2713-4ec7-8ba9-25ff6db4ea3a">Betterhash</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#e7695c05-4a96-42fb-a57e-27e3c93d3aa2">Compact Blocks</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#5c63eeca-27ae-4409-963a-67f7126576dd">P2P</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#76a407ba-ed00-4579-82a3-1929d952ca74">Wallet Engineering</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#45ef83b1-2330-4d6a-9eeb-fa897362fe5c">BIP-32</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#900854ef-205f-46ca-9048-8f57c8c74005">BIP-39</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#ea906794-ee9c-4181-8027-f635aa58ae96">Wallet Standards</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#f6bfe271-acae-404e-b90e-8fbb7a1e5746">BIP-43</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#b9b5c913-c2a4-46d5-9ced-85343f5f21d1">BIP-44</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#58945b3a-0bcc-4513-9033-6d750deb5725">BIP-45</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#e534d496-cc5a-47a6-a128-fcf64895cbb5">BIP-47</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#7b181062-4c33-4419-91bc-b106bb422680">SegWit</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#0a6ed404-ea36-4dba-a840-8b958f714aac">Covenants</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#fdc29a1c-360e-4bf3-b97c-92c2092e752d">Vaults</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#697eb869-348c-4f1f-b803-4e09cae91cd6">Batching</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#d989d56d-f60b-4898-a122-016a6f2678db">Coin Selection</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#5adac067-7dd4-4377-90d7-76f7f9a9299e">Bitcoin Core Wallet</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#2ba96219-33f7-4625-97db-98f706318eac">Descriptors</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#765c5857-2a97-4ebe-9a54-49e8fa134eae">Script</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#62f89fbd-8f4a-4c53-a4ca-90bf68abb12c">Fee Estimation</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#50ce70bc-5556-4c7d-87a1-f1380502f436">Backup and Recovery</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#e1382bc5-d869-420b-a433-6f8f9859c387">BIP39</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#5ceca4b1-2efb-4267-b191-2bc04b36e555">Shamir’s Secret Sharing</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#4164f973-2f27-40ba-99df-ddecdcdf4c31">Lightning Network</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#78ad6867-3235-4f9c-ad2f-6009bc706fc6">BOLTs</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#d391f30a-f29e-4e7d-a6be-52fa459050dc">Implementations</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#2ca5b469-a85e-40d4-9fa1-8c43938ec837">anecdotal example</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#fb08e8d6-8c7a-4a98-8c64-bc01071d5d9a">Lightning Conf 2019 Berlin</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#934a5090-e785-43ad-a057-904335285bc4">Discrete Log Contracts</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#edd3ad2e-56c3-400c-9b3b-7037ec46e980">Security</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#9ca19ba3-849a-4949-8cf5-404b6ad8ed94">Privacy</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#cf9563b0-5163-45d6-96dd-460dcdb6aa9b">Routing</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#d9fec0d4-46ab-4634-ac1c-507a3b5a7a40">Payments</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#3b98c12c-454f-4c6e-95d8-2ea818225fb2">Atomic Multi-path Payments (AMP)</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#fbdef6d1-d18e-48e4-91a4-30eb0ff3b36c">Splicing</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#e8122b54-152b-4449-951b-84886a61a09e">Submarine Swap</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#e6e5f788-a391-4c95-bba5-827bd6341635">Hold Invoices</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#88cec45e-21f8-4f81-b238-e5a38362f14f">Trampoline Payments</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#b6b048fe-68df-44d7-b2c8-08fd3eff4ad4">Static/Send/Spontaneous/Push Payments</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#6666bd59-ae08-4a68-b0d9-18e1af2a74d2">HTLCs</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#3485ed65-a52c-44d3-b18f-6269440417dd">PTLCs</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#2761c42e-2858-4e20-ab0b-23195e647c88">Future</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#0a685c5c-6a52-4cd2-b3ef-e50ca28e1f40">Operations</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#8667342d-58cb-4078-ad55-7ce644969659">Limitations</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#0f7882f3-7cfc-4d28-a618-13b2351ea099">Privacy</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#90b5c3fb-b8a5-490d-8a81-115c93a7b9d4">CoinJoins</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#82e8fb6d-35ec-422d-b78e-1023153f11dc">BIP-79</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#f10d2921-5057-43e0-b799-afee706cf651">CoinSwaps</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#84601db0-0345-4c34-991b-d9027dab506c">TumbleBit</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#f4bdd9da-c8fe-437c-be88-09db193dc723">SNICKER</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#8b3926e5-832f-4773-b734-a89bf3a7cf5c">PaySwap</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#abd2ea2c-909a-43f6-808f-54756c51741f">More Cryptography</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#e167a3a9-c683-4853-8ae9-3fe3697b240e">Chain Analysis</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#68962683-8c96-4d80-8a0e-46cd7885ce27">Security</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#7fdd82e3-863e-40a7-bbf8-6de29a22ae69">Hardware Wallets</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#e6ba1361-57f9-4bf6-929f-5ba8f0a100e0">Mining</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#20775e10-a153-4cca-a4f9-df58f4535753">Bitcoin Core</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#506a6702-7348-47d0-89dc-0115a6fbc885">Debugging</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#24df961f-e563-434c-860d-89457aa81cde">Architecture</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#50d67092-4617-41fe-9f22-a22fedfae291">Wallet</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#4f95ce1d-67f1-460d-9e8d-f717bd3e3396">History</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#740b96f8-ae5f-46c5-bb50-1aebacc4192f">Other</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#12c20179-6e1f-4767-9b37-c8971ce744a2">Future directions of bitcoin</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#1ff04b0b-af3e-4bdf-8ca3-b6f5e25a1cdc">Utreexo</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#ead4058a-ede2-4c04-8093-1ef9c95bd64b">Graftroof</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#82436512-8310-4207-8985-51303994ecf6">AssumeUTXO</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#a0d6074f-9045-4d45-a07a-5db2e1b0bbf3">CoinWitness</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#6d2de0ef-f964-4ac4-8088-e668052d479e">Covenants</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#75958c39-2491-4cf6-aa27-8f3c1d5215ef">Zero Knowledge Contigent Payment</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#03a91ead-ed13-4cad-b93d-f80abae9b266">Discreet Log Contracts</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#89a26d28-3fcd-4330-953b-dd50b853461c">Statistics</a></div></nav><h1 id="c69099a2-1292-4a37-b4da-aae0fe1331f1" class="">Introduction</h1><p id="75763012-d569-4bc4-a631-ae4e7f3b2e2e" class="">I am hoping these notes serve a useful purpose to the reader in getting started with Bitcoin or refreshing old knowledge. The best way to use this document is to search for topics by heading and sub-heading and follow hyperlinks to the original resources.</p><p id="8c25c00b-6276-4b10-84d3-6363b3674b77" class="">The audience of this document is expected to have a technical background, but this soft requirement should not let the reader become reluctant in learning about Bitcoin at a deep level.</p><p id="d68953ad-89c8-4c58-b930-a4637c81e7b0" class="">The ideal state of this document is to become an authoritative resource and practical guide for software engineers that want to build applications with Bitcoin. Any suggestions to reach that state are highly appreciated. To follow the progress of this document, please refer to the git <a href="https://github.com/philipglazman/bitcoinnotes">respository</a>.</p><p id="2dab8b4b-35d4-453a-8616-d474d36b4173" class="">The following resources are an excellent starting point:</p><p id="1fd6c8b8-13ee-4500-9af0-ded19ab33dab" class=""><a href="http://diyhpl.us/~bryan/papers2/bitcoin/">Bryan Bishop’s diyhpl.us Papers</a></p><p id="a6aec917-b649-4bcc-aaae-cc4b1e6e102b" class=""><a href="http://diyhpl.us/wiki/transcripts/">Bryan Bishop’s diyphl.us Transcripts</a></p><p id="3057267b-ba10-4b43-a11a-4d23d95262e0" class=""><a href="https://github.com/ChristopherA/Learning-Bitcoin-from-the-Command-Line/blob/master/README.md">Learning Bitcoin from the Command Line</a></p><p id="8811ba8e-709a-4d75-b3fa-024966751669" class=""><a href="http://lopp.net/bitcoin.html">Jameson Lopp’s Bitcoin Information &amp; Resources</a></p><p id="aec7dcc6-b7b4-4481-af6a-146fea1d092b" class=""><a href="https://github.com/jashmenn/bitcoin-reading-list">Jashmenn’s Bitcoin Reading List</a></p><p id="f9b0414f-a695-4bb1-ab8d-ebef4d1cebe0" class=""><a href="https://blog.bitjson.com/bitcoin-script-a-reading-list-656242edfa6c#.elntopnt6">A Bitcoin Script Reading List.</a></p><p id="9914bd37-4f08-4e20-bd18-fff16737d13f" class="">The following resources are structured:</p><p id="605b8930-7cac-48f3-ae51-fe78708417a4" class=""><a href="http://soc1024.ece.illinois.edu/teaching/ece398sc/spring2018/">Smart Contracts and Blockchain Security</a></p><p id="4016d315-ba0d-4409-a265-e55ecdc6a0fc" class=""><a href="http://soc1024.ece.illinois.edu/teaching/ece598am/fall2016/">Cryptocurrency Security</a></p><p id="34793566-bc28-4c63-af0a-9565866fd23d" class=""><a href="https://github.com/mit-dci/mas.s62">MIT DCI online course</a></p><p id="1789c4ac-e7ff-4908-a018-c8dfde4fd706" class=""><a href="https://github.com/bitcoinops/scaling-book">Scaling Bitcoin Dev++</a></p><p id="2d745e1e-95c8-472a-a540-35044ccc98b2" class="">Strongly recommend these Chaincode resources:</p><p id="efebb5a5-b4b8-4f4d-b4c0-23f3498ad955" class=""><a href="https://github.com/chaincodelabs/study-groups">Chaincode Study Groups</a></p><p id="3461010c-6305-47a2-97da-4d2f43de2d27" class=""><a href="https://github.com/chaincodelabs/bitcoin-curriculum">Chaincode Bitcoin Course</a></p><p id="5bbf7b62-9583-4197-b75a-355a145d5404" class=""><a href="https://github.com/chaincodelabs/lightning-curriculum">Chaincode Lightning Course</a></p><p id="3ddefc3d-7785-495b-b6ba-dc48d47a219a" class="">Of course, a link to the <a href="bitcoin.pdf">whitepaper</a>.</p><h1 id="27e73f89-d634-4e34-a3f5-1b471ca32b1d" class="">Protocol</h1><p id="89df2604-9b85-4235-be88-91f82702323f" class=""><em>An overview of the Bitcoin protocol and the building blocks of Bitcoin.</em><a href="https://en.bitcoin.it/wiki/Protocol_documentation">Protocol Documentation</a></p><p id="182aca78-4dc7-4876-9c6d-000bbdf45ee8" class="">Ultimately, the behavior of Bitcoin is defined by codebase of the reference client. This is not a complete survey of the bitcoin protocol, but a piecemeal overview of different components that make up Bitcoin.</p><p id="2adef2d6-9317-4096-8e6b-44ee2f6226b9" class="">The reference client, Bitcoin Core, was originally written by Satoshi, but has since been an open source project. The C++ client is the most widely used implementation of Bitcoin.<a href="about:blank#fn.1">1</a> One of the primary reasons to run the Bitcoin Core client is to stay in consensus with the rest of the network. There is no formal specification of consensus, so consensus is adopted by running the reference client. There are several noteable alternative implementations of Bitcoin, but their usage as consensus daemon are limited. An argument against adopting other implementations is the risk of breaking consensus with the network.</p><h2 id="0503f734-82d6-4f6e-95d0-b5502d23a53f" class="">Primitives</h2><h3 id="7e7ad24d-5a7c-4620-9e86-38227eecf4e9" class="">Hashes</h3><p id="d7a72a56-e2b8-4f01-99e6-e64b2ba85e3c" class="">Hashes are one-way functions that accept an input and return a fixed-length value. For the hash function to have integrity, the value returned must be unique. As a result, a strong hash function will make it unlikely that two different inptus have the same output. This is called a hash collision.</p><p id="e13db4d7-5b83-47a5-b270-6621e0107919" class="">In Bitcoin, SHA-256 and RIPEMD-160 are used. It is common to see double hashing where an input is hashed twice.</p><h3 id="0688a0f9-3fb6-41f6-afc7-048e21d417f1" class="">Merkle Trees</h3><p id="eb3dd219-b82e-4803-a313-ea9aad489dd2" class="">A merkle tree is a binary tree of hashes. It is a container that hashes items and concatenates the hashes in such a way that a final merkle root of the tree is a hash. This merkle root represents the the hashes and concatenation of all the items in the tree.</p><p id="ff516b96-59ac-4d5b-abec-9f16d2385a39" class="">In Bitcoin, merkle trees are used in a variety of ways. Most notably, a block will have a merkle root of transactions. An excellent utility of merkle trees is proving that a leaf is part of the tree.</p><h3 id="0974d88e-6e3c-4d16-a2f4-6587fdd5c9dc" class="">Signatures</h3><p id="bb5f81ff-8480-4a64-b857-7d2fb996e64e" class="">Digital signatures are used by a verifier to prove that a signature belongs to a public key. Signatures can only be created using a private key corresponding to the public key.</p><p id="299a6a38-efe5-4919-b9c4-3a8d0b9b711a" class="">Bitcoin uses ECDSA, or Ellipitic Curve Digital Signature Algorithm, to sign for transactions and messages. The curve used is secp256k1.</p><h3 id="5a01119a-08fb-4dd9-8395-2ade3bb8725a" class="">Addresses</h3><p id="045da800-ce66-4cbb-ab48-fbb13188c9ef" class="">Bitcoin addresses are a human readable format to represent a Bitcoin script. Addresses can be shared to others to receive payment. They should be treated as single-use tokens.</p><h3 id="eb0453fc-d5cd-4ba9-99a4-d0379c76aaa6" class="">Transactions</h3><h3 id="b41b852c-3908-4de2-a9bb-e9f88887dcfa" class="">Blocks</h3><h2 id="06ca2726-6c89-4828-93a8-aebfdd643bc5" class="">Consensus</h2><p id="b603bf97-7a4c-4879-a8c1-0f37fbeb028b" class="">The consensus of Bitcoin is a large topic and part of extensive research.</p><p id="abc69145-4389-4a20-a6dd-d6861b556a2d" class="">A quick glimpse into how difficult it is to describe consensus can be found in David Harding’s <a href="https://gist.github.com/harding/dabea3d83c695e6b937bf090eddf2bb3">Bitcoin Paper Errata and Details</a> document. The expectations of the software developer often does not match the reality of the code written. Ultimately, consensus is defined by the software that people choose to run on their machines. This software can have bugs and these bugs are technically part of consensus.</p><p id="85e395e4-a050-4c67-9e03-4e2d567c68fa" class="">There is also social consensus, the ideas and narratives that people choose to adopt and identify with. Social consensus can drive technical consensus to adopt new rulesets.</p><h2 id="90053964-efd7-495a-86ad-05b061da5c86" class="">Script</h2><h2 id="b06eb81f-df34-4239-8610-f6d4e81118da" class="">Segregated Witness</h2><h2 id="eef05ced-749c-4959-96ae-4012b5bd3a32" class="">Taproot/Schnorr</h2><p id="61f45e71-6f6a-43e0-aa13-5f645c493c60" class=""><em>Notes on BIP340-342. All things concerning Schnorr, Taproot, and Tapscript.</em></p><h3 id="2846bee3-b198-4fb7-99e8-25a1b2cef2b4" class="">Introduction</h3><p id="31acc841-6b4e-4365-bd57-d5396df1a37b" class=""><a href="https://prezi.com/view/AlXd19INd3isgt3SvW8g/">Slides from Sipa&#x27;s talk at SF Bitcoin Devs</a></p><p id="5e9fdf0d-0c92-4a25-9cc8-1375ca144967" class=""><a href="https://github.com/bitcoinops/taproot-workshop">Taproot Workshop</a></p><p id="f3fab77e-a6da-44f1-bbf4-04264180eb29" class=""><a href="https://github.com/ajtowns/taproot-review">Taproot Review</a></p><p id="95816f94-0f8d-416e-a0f4-6c345880316a" class="">immediate benefit of taproot: “if you lose this key, your funds are gone” to “if you lose this key, you’ll have to recover 3 of your 5 backup keys that you sent to trusted friends, and pay a little more, but you won’t have lost your funds”&quot; - anthony towns</p><p id="408ce76a-fea8-4135-a207-b1f67bde621d" class="">Notation to be used throughout (from BIP):</p><ul id="dfb54339-813e-40f1-8e07-a4454eca775b" class="bulleted-list"><li>hashtag(x) notation to refer to SHA256(SHA256(tag) || SHA256(tag) || x)</li></ul><ul id="80f2ea35-9416-41b5-9b54-8230ae21cc99" class="bulleted-list"><li>q is taproot output key</li></ul><ul id="f7c936bd-5e26-4f18-877b-cd96712ee429" class="bulleted-list"><li>p is taproot internal key</li></ul><h3 id="8489fc23-d7fa-4c5d-8f3b-21ca0d2910e6" class="">BIP340</h3><p id="ba0ad2dc-feb0-4b12-9019-ebc444823211" class=""><a href="https://github.com/bitcoin/bips/blob/master/bip-0340.mediawiki">Link to BIP340</a></p><p id="3d8acdb8-aad6-474e-9574-b6fbdf20c738" class=""><a href="https://medium.com/blockstream/reducing-bitcoin-transaction-sizes-with-x-only-pubkeys-f86476af05d7">Why only x-pubkey?</a></p><p id="a0211abc-6768-42a4-b843-ebbd4340d0e7" class="">Proposes standard for 64-byte Schnorr signatures.</p><p id="fb62059e-ee66-456e-b6ce-ee50f10e939e" class="">Why Schnorr?</p><ul id="ec0acfb1-72b0-4e50-9501-9d9cb66756f7" class="bulleted-list"><li>Provable security
Security of ECDSA rely on stronger assumptions. Schnorr signatures are provably secure.</li></ul><ul id="273bab0e-076d-47eb-9b91-be82187200e2" class="bulleted-list"><li>Non-malleability
Schnorr signatures are implied to be non-malleable given SUF-CMA security. ECDSA sigs are inherently malleable.</li></ul><ul id="cf80bbaf-c1d9-4ab8-9162-acbd11aab8a0" class="bulleted-list"><li>Linearity</li></ul><p id="b51882f2-c29c-40c1-8aef-f94c3ef418a8" class="">Encoding: Instead of DER, use fixed 64-byte format.
Public Key Encoding: Instead of compressed 33-byte key, use 32 bytes.</p><p id="5264d058-5c92-495d-966d-72c8e83b7ee8" class="">Interestingly, the aim of the BIP is to have the Schnorr spec completely specified. In the past, different ECDSA implementations caused issues.</p><p id="78916897-4279-4381-8109-82d9e2bf87e1" class=""><a href="https://suredbits.com/introduction-to-schnorr-signatures/">SuredBits’ intro to Schnorr</a></p><p id="6785f381-0d27-4084-8b06-5da3a626eff4" class="">“tweaking” involves hiding/obfuscation</p><p id="ef95698d-2cb3-4638-acef-ff1d7dda4afb" class=""><a href="https://www.math.uni-frankfurt.de/~dmst/research/papers/schnorr.blind_sigs_attack.2001.pdf">security of blind discrete log signatures</a></p><p id="996f2ede-1781-4f1d-8e3a-14aae03984f4" class=""><a href="https://www.iacr.org/archive/crypto2002/24420288/24420288.pdf">generalized bday problem</a></p><p id="cd265d3f-f611-48d8-b706-48d8d183685d" class=""><a href="https://medium.com/blockstream/reducing-bitcoin-transaction-sizes-with-x-only-pubkeys-f86476af05d7">x-only pubkeys</a></p><p id="8db1ebb1-1b01-4188-bec4-eb8ebe78649e" class=""><a href="https://eprint.iacr.org/2019/023.pdf">lattice attacks against weak ECDSA</a></p><p id="04944baa-fe92-4e55-a3fb-1408751e62cb" class="">A schnorr signature is defined as the following:
S = R + H(x(R)|P|m) * P
where R is the Nonce point (k*G)</p><p id="272a1e06-1360-432c-a78c-ef87058a476b" class="">To save 32 bytes, only the x value of R is provided by the signer.
The verifier can computer the y-value.</p><p id="dd751d81-ffe2-4f1d-94c8-c8f484ec0342" class="">One of the y-coordinates is even while the other is odd.</p><p id="1bad152c-79c5-44ad-8dd2-f2780978d38e" class="">Proposal constraints k such that y-value of R is quadratic residue module SECP256K1_FIELD_SIZE.
Quadaratic residue is having a square root modulo the field size.</p><p id="f06b0a6b-5265-42e1-943b-897dd0bb767a" class="">If a randomly generated nonce k does not yield a valid nonce point R, then the signer can negate k to obtain a valid nonce.</p><h3 id="463570d2-24f1-4ac7-9d7e-e2ea8d974509" class="">BIP341</h3><p id="54de2d49-6184-44b7-8701-9bcd2fec94a8" class=""><a href="https://github.com/bitcoin/bips/blob/master/bip-0341.mediawiki">Link to BIP341</a></p><p id="a00d6d12-3e79-423a-b588-314fdb3e6ee0" class="">Proposes new SegWit v1 output type with spending rules based on Taproot, Schnorr, and merkle branches.</p><p id="ab7e6d18-1268-4d37-9a6c-4aac6ca522fb" class="">BIP claims no new security assumptions are added.</p><p id="232b216b-c0e2-40ad-ba74-8a823bfbb5d7" class="">The aims of the output type is to improve privacy, efficiency, and flexibility of Bitcoin script. This is especially useful in minimizing how much information is shown on the blockchain regarding the spendability conditions. Additionally, a few bug fixes are included.</p><p id="76a87b47-4e2a-4de5-8e17-dab597c79ba1" class="">The BIP is very selective in the technologies that are included. Many are swept for later review in order to reduce complexity of review as well as prevent immature technology from weighind down ready technology.</p><p id="7932e8ff-f1f7-46a0-9bb4-173250dc151d" class="">From the BIP document, the following technologies compose the proposal:</p><ul id="e9c7d58d-1324-47fe-a09b-c2a4dd029dfd" class="bulleted-list"><li>Merkle Branches: Reveal the actual executed part of the script.</li></ul><ul id="8bb90568-2ab8-466e-9e26-e150117e3b20" class="bulleted-list"><li>Taproot: Merge pay-to-pubkey and pay-to-scripthash policies making outputs spendable by either indistiguishable.
As long as key-based spending path is used for spending, it is not revealed whether a script path was permitted as well.
An assumption is made that most outputs can be spent by all parties agreeing. Schnorr permits key aggregation.<p id="1f484118-b6e3-4783-b38e-8c5a1553ba72" class=""><a href="about:blank#fn.2">2</a></p></li></ul><p id="6d3af981-a823-4af6-91ac-d1a79ca394c4" class="">Key aggregation allows a public key to be constructed from multiple participant keys. Indistinguishable from single-party.</p><ul id="0cf2218d-d91b-45bc-9603-dbb4868f4592" class="bulleted-list"><li>Batch validation is permited with schnorr signatures.</li></ul><ul id="9d077aef-f205-4388-b210-695fe4315916" class="bulleted-list"><li>Every merkle tree has an associated version allowing for new script versions to be introduced via soft fork. Unused ‘annex’ in the witness can also be used.</li></ul><ul id="bc874241-4d6c-4a33-8ed8-ac21916d8a30" class="bulleted-list"><li>New Signature Hashing Algorithm includes amount and ScriptPubKey in message. And uses tagged hashes.</li></ul><ul id="ff951ea3-692a-41ce-bf24-144403b36ca9" class="bulleted-list"><li>The public key is directly included in the output.</li></ul><p id="3919bca3-d38a-4276-8a63-54fa819915f5" class="">BIP can be informally summarized in the following way:</p><pre id="1309bf2f-9a38-41e7-9e33-5b77e5560551" class="code code-wrap"><code>a new witness version is added (version 1), whose programs consist of 32-byte encodings of points Q. Q is computed as P + hash(P||m)G for a public key P, and the root m of a Merkle tree whose leaves consist of a version number and a script. These outputs can be spent directly by providing a signature for Q, or indirectly by revealing P, the script and leaf version, inputs that satisfy the script, and a Merkle path that proves Q committed to that leaf. All hashes in this construction (the hash for computing Q from P, the hashes inside the Merkle tree&#x27;s inner nodes, and the signature hashes used) are tagged to guarantee domain separation.</code></pre><p id="2d9398c7-5ec8-4b22-b94f-6c132030e2be" class="">A taproot output is a native SegWit output with version number 1 and a 32-byte witness program.</p><p id="df5182d7-bd06-48e4-9ea8-19c1d823a9d0" class="">Every taproot output corresponds to a combination of a single public key condition (internal key), and zero or more general conditions encoded in scripts in a tree.</p><p id="7dc688c4-cd45-4c72-94ec-9fcd4f6a7ee5" class="">General guidelines for construction and spending Taproot outputs:</p><ul id="b3ec8aa3-518a-4cca-94ed-f567e81dc2ce" class="bulleted-list"><li>Better to split scripts with conditionls (OP_IF) into multiple scripts in the tree…each corresponding to one execution path.</li></ul><ul id="3a379ee0-1ef8-4ded-8151-489d6d8c1b7b" class="bulleted-list"><li>When a single condition requires signautres from multiple keys, key aggregation MuSig can be used.</li></ul><ul id="92ec89d4-e5f4-4dee-97ec-3aafbd41ea5d" class="bulleted-list"><li>Most likely key to be used should be the internal key. If no such condition exists, worthwhile adding one that consists of an aggregation of all keys. This is an “everyone agrees” branch. Else just pick an internal key using a point wi unknown discrete logarithm. See BIP for example.</li></ul><ul id="ffad172d-fe7c-45df-989d-8256c5747e9c" class="bulleted-list"><li>If no script conditions needed, an output key should commit to an unspendable script path instead. See BIP for how to achieve this.</li></ul><ul id="8c127b81-2df8-4d5f-a3a3-45e479649f6f" class="bulleted-list"><li>Remaining scripts should be organized into leaves. Huffman tree.</li></ul><ul id="9e0ebbf3-a240-46eb-8f6e-b7408cf02f33" class="bulleted-list"><li>Binary tree leaves are (leaf_version, script) tuples.</li></ul><p id="94418037-1bdf-4296-af02-0afd7481a458" class="">Q=P+H(P,m)*G
where P is public key and m is merkle root of a MAST.</p><p id="a09eea28-5c45-437a-8d8f-360ac8433b82" class=""><a href="https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2018-January/015614.html">switchable scripting</a></p><h3 id="70fa74b2-bb61-4e8a-b899-b5a3edbd253f" class="">BIP342</h3><p id="903a7a03-92d9-4411-8885-69d7fdc6a5c9" class=""><a href="https://github.com/bitcoin/bips/blob/master/bip-0342.mediawiki">Link to BIP342</a></p><p id="2df2a600-d126-4f16-8a26-575a8db83ed0" class="">Proposes semantics of the scripting system described in BIP341.</p><p id="504dc047-c85f-4468-a5b5-8b6d361c87ae" class="">Includes improvements to schnorr signatures, batch validation, and signature hash.</p><p id="e8a0b5c5-ceab-479c-8b80-6d95393a62d7" class="">OP_CHECKSIG and OP_CHECKSIGVERIFY are modified to verify schnorr signatures.
OP_CODESEPARATOR simplified.</p><p id="8e9f77d2-71ad-4169-a70b-6ce25b42ffb2" class="">OP_CHECKMULITSIG and OP_CHECKMULTISIGVERIFY are disabled. OP_CHECKSIGADD is introduced to make multisigs batch-verifiable.</p><p id="899b0430-6765-4432-b619-241485c4aff0" class="">A potential malleability vector is eleminated by requiring MINIMALIF. Using a non-standard represetentation of true for OP_IF is now considered invalid as a violation of consensus rules.</p><p id="fa117323-b1d4-42ee-9d49-c20e8a4e6c32" class="">OP_SUCCESS opcodes allows introducing new opcodes cleanly than through OP_NOP.</p><p id="e13a80be-a944-4f5b-bf4e-af675443078e" class="">Tapscript can be upgraded through soft forks by defining unknown key types. For example, adding a new hash_types or signature algorithms.</p><h3 id="8d8e02e3-2282-4166-8db7-6d87edc61db6" class="">MuSig</h3><p id="12d1a009-771f-43f8-811c-4f6da624d089" class="">Schnorr multi-signature scheme.</p><p id="94a103f7-ab06-4af5-adef-f3157cd35e0e" class="">Blockstream announcing <a href="https://blockstream.com/2019/02/18/en-musig-a-new-multisignature-standard/">MuSig.</a></p><p id="01478b31-cc84-49b9-83d5-801a8919d4ba" class=""><a href="https://eprint.iacr.org/2018/068.pdf">actual whitepaper</a></p><p id="2cb1ef9b-59e7-4573-8f79-282e55c34fc0" class=""><a href="https://suredbits.com/schnorr-applications-musig/">SuredBits’ blog on musig</a></p><p id="2031f626-89fb-4757-a8e3-78ac4c661d56" class=""><a href="https://medium.com/blockstream/insecure-shortcuts-in-musig-2ad0d38a97da">Insecure Shortcuts in MuSig</a></p><p id="238a2583-c230-46b0-ac3e-7f849860d9b9" class=""><a href="https://medium.com/blockstream/musig-dn-schnorr-multisignatures-with-verifiably-deterministic-nonces-27424b5df9d6">MuSig-DN: Deterministic Nonces</a></p><p id="3fb3ebc3-7df7-4b1e-b9c4-35b987845296" class=""><a href="https://bitcoin.stackexchange.com/questions/91534/musig-signature-interactivity">MuSig Interactivity</a></p><p id="323ad719-ea4c-4d20-8d5f-f7c5307102e5" class=""><a href="https://joinmarket.me/blog/blog/the-soundness-of-musig/">The Soundness of MuSig</a></p><ol id="2c8cb0a8-8048-4dca-a898-8fdf54b6e35e" class="numbered-list" start="1"><li>MuSig2<p id="c58b9cb2-2a45-4a0d-8804-9a2978dbeaec" class="">Exchanging nonce commitments is the subject of the <a href="https://medium.com/blockstream/musig-dn-schnorr-multisignatures-with-verifiably-deterministic-nonces-27424b5df9d6">MuSig-DN paper</a>.</p><p id="07c1e831-38bb-430c-af6d-82ab1c2768eb" class="">Nonce commitment exchange can be removed by generating the nonce deterministically from the signers’ public keys and message.
Providing a non-interactive zk proof that the nonce was generated deterministically along with the nonce.</p><p id="e1e271df-5feb-4bd1-9fd9-96ddc07bf7a7" class="">The MuSig2 scheme has a two round signing protocol w/o the need for a sk proof.
Also, the first round of the nonce exchange is done at key setup time.</p><p id="4a295d57-6b72-4626-b550-957536e2fb2b" class="">Therefore, there are two variants: interactive setup and non-interactive setup.</p><p id="238225af-45b2-4958-b1b9-72613954b480" class=""><a href="https://bitcoinops.org/en/newsletters/2020/10/21/">BitcionOps explains MuSig2</a></p><p id="6b5f4ceb-0b37-4789-9e3d-b5628f232afe" class=""><a href="https://eprint.iacr.org/2020/1261">MuSig2</a></p></li></ol><h3 id="513ed7dd-7801-4402-a6d9-59771727a562" class="">SIGHASH_ANYPREVOUT</h3><p id="09e73b92-d6e6-4b47-ac47-0acee593c22f" class=""><a href="https://github.com/ajtowns/bips/blob/bip-anyprevout/bip-anyprevout.mediawiki">proposed bip</a></p><p id="b04ca979-35ed-4cb0-8d59-c45278407ca8" class="">a new type of public key for tapscript (bip-tapscript) transactions. It allows signatures for these public keys to not commit to the exact output being spent. This enables dynamic binding of transactions to different UTXOs, provided they have compatible scripts.</p><p id="9b1497dc-3313-4195-937d-1403c4d3b03f" class="">Allows dynamic rebinding of a signed transaction to another previous output of the same value</p><h2 id="b44f0e97-68bd-4b14-b470-3994b0fed56a" class="">Mining</h2><p id="afddff17-ecb1-4e05-a2a0-3e160f2072e1" class=""><em>All things Bitcoin mining.</em></p><h3 id="71c6ee36-69b2-4068-b86c-6dca87668230" class="">Introduction</h3><p id="751c9650-5873-42fb-862b-70f2a2da4f42" class=""><a href="https://stephanlivera.com/episode/128/">Excellent podcast on mining</a></p><p id="8cecc31d-899f-425c-944c-24341e24dbfa" class="">cgminer is open source miner for ASIC/FPGA miner. Lots of companies forked off this original miner.<a href="https://github.com/ckolivas/">https://github.com/ckolivas/</a></p><p id="5df45ede-c04b-4414-8faf-bcf3c0be2d06" class=""><a href="https://bitcointalk.org/index.php?topic=2135429.msg21352028">channel payouts in mining</a></p><h3 id="6b1e788a-a4ec-49c3-b548-679b0c4778bd" class="">GetBlockTemplate</h3><p id="65d260de-c8a2-43e2-8255-bbcc785e3893" class="">Getblocktemplate: bitcoin core &lt;-&gt; pool server</p><h3 id="66efa13c-3a79-4e4b-b975-b902ef2ef296" class="">Stratum</h3><p id="e3bd7885-7a33-48c8-859e-3f412862a6f0" class="">Stratum: pool server &lt;-&gt; asic controller </p><p id="b3980410-96a0-48ae-9e6b-0c89527ccc34" class=""><a href="https://slushpool.com/help/topic/stratum-protocol/">Stratum Protocol documentation</a>
</p><p id="53382214-511d-480b-932d-f37474aa070a" class="">The design of the Stratum protocol requires pool operators to build and distribute block templates to their clients.</p><h3 id="a8ca697d-b8fd-4425-87af-904f1515ca51" class="">StratumV2</h3><p id="b72e88b9-965c-48e4-82b4-977004dc9e88" class=""><a href="https://insights.deribit.com/market-research/stratum-v2-migration-and-decentralization/">StratumV2 Migration</a></p><h3 id="083f1957-2713-4ec7-8ba9-25ff6db4ea3a" class="">Betterhash</h3><ul id="eab14e99-469b-46a7-9c16-3fe84d16dde1" class="bulleted-list"><li>Work protocol: bitcoin</li></ul><ul id="ddc06c78-2601-4a08-9c91-7ddbb914871b" class="bulleted-list"><li>core &lt;-&gt; mining proxy</li></ul><ul id="92937a00-c716-4711-b0d0-6208560e53ca" class="bulleted-list"><li>Work protocol: mining proxy/bitcoin core &lt;-&gt; asic controller</li></ul><ul id="f7d99943-757d-4505-bd92-583026a206b3" class="bulleted-list"><li>Pool protocol: pool server &lt;-&gt; mining proxy</li></ul><p id="809ffa01-deac-4f1a-8fee-ac296c0bee45" class=""><a href="https://github.com/TheBlueMatt/bips/blob/betterhash/bip-XXXX.mediawiki">link to bip</a></p><p id="73049b3c-3fd9-4eae-a810-d3e2fffe8feb" class=""><a href="https://medium.com/hackernoon/betterhash-decentralizing-bitcoin-mining-with-new-hashing-protocols-291de178e3e0">betterhash overview</a></p><h3 id="e7695c05-4a96-42fb-a57e-27e3c93d3aa2" class="">Compact Blocks</h3><p id="6712c204-ed4f-43da-a8ee-f2f8792c294f" class=""><a href="https://bitcoincore.org/en/2016/06/07/compact-blocks-faq/">faq for compact blocks</a>
Compact block relay, BIP152, is a method of reducing the amount of bandwidth used to propagate new blocks to full nodes.</p><p id="20207c1c-4dd9-4be0-ad80-973a4141ff8c" class="">Using simple techniques it is possible to reduce the amount of bandwidth necessary to propagate new blocks to full nodes when they already share much of the same mempool contents. Peers send compact block “sketches” to receiving peers.</p><h2 id="5c63eeca-27ae-4409-963a-67f7126576dd" class="">P2P</h2><p id="df95a915-9682-422d-90f9-8ab3f84a12c2" class=""><em>P2P layer of Bitcoin.</em>
For the Bitcoin network to remain in consensus, the network of nodes must not be partitioned. So for an individual node to remain in consensus with the network, it must have at least one connection to that network of peers that share its consensus rules.</p><p id="243b3453-3b3c-4ed5-8022-11a83807425e" class=""><a href="https://gist.github.com/sdaftuar/c2a3320c751efb078a7c1fd834036cb0">partition resistance</a></p><h1 id="76a407ba-ed00-4579-82a3-1929d952ca74" class="">Wallet Engineering</h1><p id="615661ea-c6b0-4f13-83eb-8a3e7de8e3f4" class=""><em>Wallet Design concerns all things related to wallet functionality. This mostly is application level logic.</em></p><p id="467a2d28-1156-4d14-a96f-97d9221d436a" class="">Modern bitcoin wallets are known as HD wallets or hierarchical deterministic. An HD wallet has a seed and can derive many child keys from a single key. In the early development of bitcoin, wallets would generate a new key for each receive address and then save the key to a file. This unfortunately made backups difficult and error prone. Instead, HD wallets can be backed up using a seed. The familiar 12 or 24 word mnemonic seed phrases are an artifact part of BIP39.</p><h2 id="45ef83b1-2330-4d6a-9eeb-fa897362fe5c" class="">BIP-32</h2><p id="3c38df89-45da-4843-9372-82b877674552" class="">Wallets derive a number of child keys from a parent key. To prevent relying on only the key, both private and public keys are extended with an extra 32 bytes of entropy. This entropy is called the chain code.</p><p id="0ed027be-d7ef-49a7-8d92-ebbe1d0f9c4b" class="">There are 2^31 child keys and 2^31 hardened child keys. The distinction is very important.</p><ul id="bf76c73c-f69a-4eb4-87b7-430adbe12aa1" class="bulleted-list"><li>private parent key -&gt; private child key = computes a child extended private key from the parent extended private key</li></ul><ul id="ec4bce19-293c-4731-b036-26508c32e0fd" class="bulleted-list"><li>public parent key -&gt; public child key = computes a child extended public key from the parent extended public key. It is only defined for non-hardened child keys.</li></ul><ul id="95ffd67b-1041-43a9-adfb-a214681263e2" class="bulleted-list"><li>private parent key -&gt; public child key = computes the extended public key corresponding to an extended private key (the “neutered” version, as it removes the ability to sign transactions).</li></ul><ul id="65cefe5c-006b-4074-9c8f-a4722e63424a" class="bulleted-list"><li>public parent key -&gt; private child key = not possible</li></ul><p id="401bf460-7cdd-4ca3-8e20-0ce0ba95fe03" class=""><a href="https://bitcoin.stackexchange.com/questions/62533/key-derivation-in-hd-wallets-using-the-extended-private-key-vs-hardened-derivati">Deep Dive on Extended Keys</a></p><p id="8a8acf4a-4fe2-4b9e-9e5f-e7c9c6ea3160" class="">A derivation path is the descriptor for identifying the path along the BIP32 tree.</p><h2 id="900854ef-205f-46ca-9048-8f57c8c74005" class="">BIP-39</h2><h2 id="ea906794-ee9c-4181-8027-f635aa58ae96" class="">Wallet Standards</h2><p id="94a95a1d-b0df-46bf-b59b-c2d92c943504" class="">Due to the flexibility of BIP32 trees, standards were created for wallet operators. Standards for the BIP32 tree allows for saner backups and easier portability of seeds between wallet services.</p><h2 id="f6bfe271-acae-404e-b90e-8fbb7a1e5746" class="">BIP-43</h2><p id="632177e9-47d9-4d27-8658-52bc4d937f2f" class="">The first of these standards is <a href="https://github.com/bitcoin/bips/blob/master/bip-0043.mediawiki">BIP-43</a> which defines the first level of the BIP32 tree as the purpose field.</p><h2 id="b9b5c913-c2a4-46d5-9ced-85343f5f21d1" class="">BIP-44</h2><p id="f8903948-4ccd-4d15-9a3d-7d6a74969f4f" class=""><a href="https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki">BIP-44</a> expands on BIP-43 by specifying the coin and account levels of the BIP32 tree. In addition, the derivation path can describe whether the wallet should derive a change (or internal) address or receive (or external) address.</p><h2 id="58945b3a-0bcc-4513-9033-6d750deb5725" class="">BIP-45</h2><p id="53ea99b3-505d-4e0f-a836-f90ba3ebf38d" class=""><a href="https://github.com/bitcoin/bips/blob/master/bip-0045.mediawiki">BIP-45</a></p><h2 id="e534d496-cc5a-47a6-a128-fcf64895cbb5" class="">BIP-47</h2><h2 id="7b181062-4c33-4419-91bc-b106bb422680" class="">SegWit</h2><p id="6d10a1fe-e514-46ef-8bc5-4f99e2fc994e" class="">Since SegWit, couple of changes to wallets were needed:<a href="https://bitcoincore.org/en/segwit_wallet_dev/">SegWit wallet dev guide</a></p><p id="5fe734f8-d815-4c29-9f53-e2d3a22d3265" class="">One of the immediate problems that SegWit solves is mitigating transaction malleability.</p><h2 id="0a6ed404-ea36-4dba-a840-8b958f714aac" class="">Covenants</h2><p id="8c9b5468-d83e-423c-b4b1-1de0bfb1adfd" class="">A covenant is a bitcoin script that restricts the type of transaction that can spend a coin.</p><p id="d8d16481-e8fe-44c0-94ab-f790ef9e0576" class=""><a href="https://bitcointalk.org/index.php?topic=278122.0">Greg Maxwell’s Bitcoin Talk thread on covenants</a></p><p id="d6cb6240-cbab-4c51-bd05-0fed1c588dad" class=""><a href="https://medium.com/blockstream/cat-and-schnorr-tricks-i-faf1b59bd298">OP_CAT and Schnorr - Part 1</a></p><p id="e50d9141-270f-471d-a585-ae592b11ce46" class=""><a href="https://www.wpsoftware.net/andrew/blog/cat-and-schnorr-tricks-ii.html">OP_CAT and Schnorr - Part 2</a></p><h2 id="fdc29a1c-360e-4bf3-b97c-92c2092e752d" class="">Vaults</h2><p id="7c1d8a80-8eda-4759-8187-f7539437de0a" class=""><a href="https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2019-August/017229.html">Vaults without Covenants</a><a href="https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2019-August/017231.html">more by bishop</a></p><p id="67446fc1-6014-4604-a4a6-4b08a6d5ddb6" class=""><a href="https://blockstream.com/2019/02/04/en-standardizing-bitcoin-proof-of-reserves/">proof of reserves - blockstream</a></p><p id="fe15564f-a193-413d-b1de-1173e2eedb09" class="">BIP-127 proposes a standard way to do proof of reserves using a PSBT extension.<a href="https://github.com/bitcoin/bips/blob/master/bip-0127.mediawiki">link to bip</a></p><p id="5779e724-7b1e-480e-b3aa-a1951506affa" class="">There’s rust implementation of a Proof-of-Reserves Client. <a href="https://github.com/ElementsProject/reserves">link to reserves</a></p><p id="29ba617f-623a-449a-9c46-a6d253c0b606" class=""><a href="https://arxiv.org/pdf/2005.11776.pdf">custody protocols using bitcoin vaults</a></p><h2 id="697eb869-348c-4f1f-b803-4e09cae91cd6" class="">Batching</h2><p id="781f92aa-88b0-4c8a-854a-b001583f9885" class="">Payment batching, more <a href="https://github.com/bitcoinops/scaling-book/blob/master/x.payment_batching/payment_batching.md">here</a>, is including multiple payments inside a single transaction.</p><p id="f7d2869c-2cf1-4d0d-b647-5347482335ca" class="">Variables to consider are # of inputs and # of outputs. Better to have a single input and many outputs.
It is also nice to have a lower fee for the entire transaction.</p><p id="68388399-d688-4fb5-a270-012d2cec7079" class="">Goal of batching is to lower vbytes per payment. Marginal improvmenent after 1 input and 5 outputs.</p><h2 id="d989d56d-f60b-4898-a122-016a6f2678db" class="">Coin Selection</h2><p id="3117c5fc-03b7-4003-a9a6-070b0772da49" class=""><a href="https://medium.com/@lopp/the-challenges-of-optimizing-unspent-output-selection-a3e5d05d13ef">Challenges of coin selection by lopp
</a><a href="https://iohk.io/en/blog/posts/2018/07/03/self-organisation-in-coin-selection/">iohk on coinsel
</a><a href="https://bitcoin.stackexchange.com/questions/1077/what-is-the-coin-selection-algorithm">what is coinsel?
</a><a href="https://diyhpl.us/wiki/transcripts/scalingbitcoin/milan/coin-selection/">murch transcript at scaling </a></p><p id="156128db-7380-4375-bdab-086ce42ac5f5" class=""><a href="https://diyhpl.us/wiki/transcripts/scalingbitcoin/milan/coin-selection/">bitcoin</a><a href="http://diyhpl.us/wiki/transcripts/scalingbitcoin/tokyo-2018/edgedevplusplus/coin-selection/">edge++ transcript</a></p><p id="2367c62f-0fb2-41bc-af63-2d873dd1ccb3" class="">The naive approach would be to simply look for the smallest output that is larger than the amount you want to spend and use it, otherwise start adding the next largest outputs until you have enough outputs to meet the spend target. However, this leads to fracturing of outputs until the wallet becomes littered with unspendable “dust.”</p><p id="999679b2-e677-415b-a592-2b3fced13bba" class="">“Our idea is to have the user the option (either global or per account or
per transaction) to choose between”maximize privacy&quot; or “minimize fees”
(or even maybe “minimize UTXO”</p><p id="760e713d-d05a-4616-a0b6-0bc034db3285" class="">”Dust” refers to transaction outputs that are less valuable than three times the mininum transaction fee and are therefore expensive to spend.</p><p id="0f3bd7f0-1e79-40c1-a77f-df7675d4bc94" class="">A transaction output is labeled as dust when its value is similar to the cost of spending it. Precisely, Bitcoin Core sets the dust limit to a value where spending an 2.3. Transactions 7 output would exceed 1/3 of its value. This calculation is based on the minimum relay transaction fee, a node setting that causes transactions that don’t at least include this lower bound of fee to be dropped from the memory pool, and not relayed to other nodes. With the default for the minimum relay transaction fee set to 1 000 satoshi per kilobyte, and the sizes of a P2PKH input being 148 bytes, and an output being 34 bytes, this computes to all outputs smaller or equal to 546 satoshis being considered dust by Bitcoin Core [Erha15].</p><p id="a4ab3223-2b3c-4b9d-9074-272f7ed5b331" class=""><a href="https://blog.bitgo.com/utxo-management-for-enterprise-wallets-5357dad08dd1">utxo mgmt for enterprise wallets</a></p><h2 id="5adac067-7dd4-4377-90d7-76f7f9a9299e" class="">Bitcoin Core Wallet</h2><p id="735ece5f-7d06-4dc7-a079-4d3f9234a032" class="">Bitcoin Core’s wallet is always evolving. Some changes to the Bitcoin Core wallet:

<a href="https://github.com/bitcoin-core/bitcoin-devwiki/wiki/Wallet-Class-Structure-Changes">Wallet Class Structure Changes
</a><a href="https://gist.github.com/sipa/125cfa1615946d0c3f3eec2ad7f250a2">Sipa describing wallet changes
</a><a href="http://diyhpl.us/wiki/transcripts/bitcoin-core-dev-tech/2019-06-05-wallet-architecture/">Wallet Architecture transcripts
</a><a href="https://achow101.com/2020/10/0.21-wallets">What’s Coming to Bitcoin Core Wallet in 2021
</a><a href="https://github.com/bitcoin/bitcoin/blob/master/doc/release-notes.md#experimental-descriptor-wallets">Descriptor Wallets MD</a></p><h2 id="2ba96219-33f7-4625-97db-98f706318eac" class="">Descriptors</h2><p id="0ffc2246-d45c-4da0-96ee-990ae010f0dd" class=""><a href="https://github.com/bitcoin/bitcoin/issues/17190">Bitcoin Issue 17190
</a><a href="https://github.com/spesmilo/electrum/issues/5715">Electrum on Descriptors
</a><a href="https://github.com/bitcoin/bitcoin/blob/master/doc/descriptors.md">Descriptors Overview
</a><a href="http://diyhpl.us/wiki/transcripts/bitcoin-core-dev-tech/2018-10-08-script-descriptors/">coredev talk</a></p><p id="7bc54605-f562-442c-8c9d-c21b352bbfbb" class="">Implementations…
<a href="https://github.com/bitcoin-core/HWI/blob/95c9387215fd534bb7a7e3e1885d92cc22457847/hwilib/descriptor.py">HWI
</a><a href="https://github.com/bitcoin/bitcoin/pull/16528">Bitcoin #16528
</a><a href="https://github.com/bitcoin/bitcoin/blob/befdef8aee899dcf7e40aa5ea4bc1b0256381cdc/src/util/spanparsing.cpp">Bitcoin Core parsing
</a><a href="https://github.com/bitcoin/bitcoin/pull/15764">Bitcoin #15764</a></p><h2 id="765c5857-2a97-4ebe-9a54-49e8fa134eae" class="">Script</h2><p id="eaa1fd1b-31ca-4ac3-ab59-3871cb3e9551" class="">(<a href="https://en.bitcoin.it/wiki/Contract">https://en.bitcoin.it/wiki/Contract</a>)
Each transaction input has a sequence number. In a normal transaction that just moves value around, the sequence numbers are all UINT_MAX and the lock time is zero. If the lock time has not yet been reached, but all the sequence numbers are UINT_MAX, the transaction is also considered final.</p><p id="b6f29a59-6e3e-451e-b795-12b429ca4731" class="">Sequence numbers can be used to issue new versions of a transaction without invalidating other inputs signatures, e.g., in the case where each input on a transaction comes from a different party, each input may start with a sequence number of zero, and those numbers can be incremented independently.</p><p id="14790c2b-f0ed-458e-a348-4ef00d7cb149" class="">Signature checking is flexible because the form of transaction that is signed can be controlled through the use of SIGHASH flags, which are stuck on the end of a signature. In this way, contracts can be constructed in which each party signs only a part of it, allowing other parts to be changed without their involvement. The SIGHASH flags have two parts, a mode and the ANYONECANPAY modifier:</p><ol id="3be76906-7369-4508-851a-8b407069f41f" class="numbered-list" start="1"><li>SIGHASH_ALL: This is the default. It indicates that everything about the transaction is signed, except for the input scripts. Signing the input scripts as well would obviously make it impossible to construct a transaction, so they are always blanked out. Note, though, that other properties of the input, like the connected output and sequence numbers, are signed; it’s only the scripts that are not. Intuitively, it means “I agree to put my money in, if everyone puts their money in and the outputs are this”.</li></ol><ol id="b4458acb-c672-4f74-988b-946fe2160ad9" class="numbered-list" start="2"><li>SIGHASH_NONE: The outputs are not signed and can be anything. Use this to indicate “I agree to put my money in, as long as everyone puts their money in, but I don’t care what’s done with the output”. This mode allows others to update the transaction by changing their inputs sequence numbers.</li></ol><ol id="c5ecc204-f536-4511-9c58-05733d32db86" class="numbered-list" start="3"><li>SIGHASH_SINGLE: Like SIGHASH_NONE, the inputs are signed, but the sequence numbers are blanked, so others can create new versions of the transaction. However, the only output that is signed is the one at the same position as the input. Use this to indicate “I agree, as long as my output is what I want; I don’t care about the others”.</li></ol><p id="410eb9fc-cb7c-44e0-b579-3f47d1805f69" class="">There are two general patterns for safely creating contracts:</p><ol id="54f944e3-3b83-4a7c-9acb-88e99d75790c" class="numbered-list" start="1"><li>Transactions are passed around outside of the P2P network, in partially-complete or invalid forms.</li></ol><ol id="1523b5bc-342e-4c76-afa7-77e5157618fb" class="numbered-list" start="2"><li>Two transactions are used: one (the contract) is created and signed but not broadcast right away. Instead, the other transaction (the payment) is broadcast after the contract is agreed to lock in the money, and then the contract is broadcast.</li></ol><p id="7b2985da-281c-44ef-9ca9-14f248023a39" class="">This is to ensure that people always know what they are agreeing to.
Together, these features let us build interesting new financial tools on top of the block chain.</p><p id="14439b63-5fe7-45fd-a108-f0dcbd14007b" class="">It may even be that people find themselves working for the programs because they need the money, rather than programs working for the people.</p><p id="1ef59f79-0970-4bbe-ac4d-1f8a7f8c1764" class="">old oracle services…<a href="https://docs.oraclize.it/#home">https://docs.oraclize.it/#home</a><a href="http://orisi.org/">http://orisi.org/</a><a href="http://earlytemple.com/">http://earlytemple.com/</a><a href="https://en.bitcoin.it/wiki/Contract#Example_4:_Using_external_state">https://en.bitcoin.it/wiki/Contract#Example_4:_Using_external_state</a></p><ol id="17227055-c857-4ef2-adf1-ef9409e18075" class="numbered-list" start="1"><li>Scriptless Scripts<p id="3a30a185-daf8-4c48-b85f-bee097665ada" class=""><a href="https://suredbits.com/schnorr-applications-scriptless-scripts/">SuredBits’ blog on scriptless scripts</a></p><p id="9745dd40-2e8c-4828-9b24-1260751f9a1d" class=""><a href="https://download.wpsoftware.net/bitcoin/wizardry/mw-slides/2018-05-18-l2/slides.pdf">Poelstra ppt</a></p></li></ol><h2 id="62f89fbd-8f4a-4c53-a4ca-90bf68abb12c" class="">Fee Estimation</h2><p id="b7eeda70-2012-4e14-a032-c53630e380a0" class=""><a href="https://blog.bitgo.com/the-challenges-of-bitcoin-transaction-fee-estimation-e47a64a61c72">lopp on fee estimation</a></p><p id="e470d3f6-4cc4-481c-abf0-c81b9b6202dd" class="">Fee estimation is the process of estimating a particular fee rate to use for a transaction in order to incentivize block inclusion at a particular block target.</p><p id="5d99f2be-aa28-4632-ab15-62a28299ab7a" class="">Supply (blocks) and demand (txns) are unpredicable.</p><p id="df2cd1e8-3049-49b6-b0db-be1e0d7022e0" class=""><a href="https://bitcointechtalk.com/an-introduction-to-bitcoin-core-fee-estimation-27920880ad0">John Newbery’s intro to Bitcoin Core Fee Estimation
</a><a href="https://bitcointechtalk.com/whats-new-in-bitcoin-core-v0-15-part-2-41b6d0493136">pt2</a></p><ol id="d4cbec72-b3f1-4910-a38e-4203f412a844" class="numbered-list" start="1"><li>Outline of Newbery’s post<p id="863ee140-41c2-46b3-abb8-1631713b74c6" class="">At broadcast, the transaction is not going to get into the next block. But rather likely the next block in 10 minutes. Block production follows Poisson distribution.</p><p id="08731449-ca28-4efd-9252-2efc4a11c445" class="">As a result, the fee rate should be competitive not only of the current mempool but the likely mempool in ten minutes.</p><p id="b2a0b508-1b84-4e16-87fa-0ad3ebc04507" class="">Looking only at mempool does not consider lucky block runs.</p></li></ol><ol id="85b5a86d-2808-4218-a1f3-b493ec43836f" class="numbered-list" start="2"><li>Bitcoin Core’s Fee Estimation
Also, the following is recorded:<p id="0671fcbf-5ff0-4c1b-81ec-8c52e9300d17" class=""><a href="https://gist.github.com/morcos/d3637f015bc4e607e1fd10d8351e9f41">High level desc of Bitcoin Core’s fee estimation algorithm</a><a href="https://github.com/bitcoin/bitcoin/blob/master/src/policy/fees.h">code</a>
Bitcoin core groups transaction fee rates into buckets. Each buck is a range of fee rates. A track of block targets from 1 block to 1008 blocks is kept.</p><ol id="08955198-90f1-4824-ad9b-59b25b19abf9" class="numbered-list" start="1"><li>number of transactions that entered the mempool in each fee rate bucket.</li></ol><ol id="f31e348d-3d60-426e-8fa7-8579fd901bc7" class="numbered-list" start="2"><li>for each bucket-target pair, the number of transactions that were included in a block within the target number of blocks.</li></ol><p id="364205b0-539c-4270-9d3f-9a0c88bdb5d5" class="">For any target-bucket pair, Bitcoin Core can find the probability that a transaction with the fee rate can be included. This is B/A.</p><p id="2ea763f8-1767-421f-9aef-883850423d3b" class=""><a href="https://blog.iany.me/2020/08/bitcoin-core-fee-estimate-algorithm/">Additional overview</a></p></li></ol><ol id="b250eb2a-7860-4e0b-9a17-d35e11769a73" class="numbered-list" start="3"><li>Mempool File Format<p id="a374fcae-21db-4332-aaa3-2ab95baa7f4a" class="">Mempool File Format can be useful for fee estimation..<a href="https://bc-2.jp/bb2019-mempool-analysis-simulation.pdf">talk by kalle</a>
Time series of a txn lifecyle until block inclusion in a small file format.</p><p id="3de97e77-0f99-4b45-b1ae-28f45b75e752" class=""><a href="https://github.com/kallewoof/mff">https://github.com/kallewoof/mff</a></p></li></ol><ol id="6963befe-4a73-4110-b8e7-bdc808627c0f" class="numbered-list" start="4"><li>Light Clients<p id="d5990c0d-c320-4d9b-9876-cec76a9e2be0" class=""><a href="https://bitcoindevkit.org/blog/2021/01/fee-estimation-for-light-clients-part-1/">Using AI for Fee Estimation</a></p></li></ol><h2 id="50ce70bc-5556-4c7d-87a1-f1380502f436" class="">Backup and Recovery</h2><h3 id="e1382bc5-d869-420b-a433-6f8f9859c387" class="">BIP39</h3><p id="f66586af-d6a7-477e-8aef-16f5a7e67284" class="">US NIST recommends a salt length of 128 bits. Passphrase entropy in bits is log2(# of combinations).</p><p id="723bf72d-a155-4de8-835a-ff675d5859dc" class="">BIP39 Wordlist is 2048 word dictionary. So log2(2048^s) = 22 bits of entropy.</p><h3 id="5ceca4b1-2efb-4267-b191-2bc04b36e555" class="">Shamir’s Secret Sharing</h3><p id="1f5d50af-d10f-4e21-a91c-8f383fc9106e" class=""><a href="about:blank#fn.3">3</a>Shamir’s Secret Sharing (SSS) is an algorithm to divide a secret into parts that can be recovered by combining a minimum number of parts.</p><p id="b67340fc-910f-4beb-971f-deacde3d8aa8" class="">Each part is called a share. The threshold is the number of shares that is needed to recover the original secret. There can be more shares than the threshold.</p><p id="6bb15485-71d7-4e4b-8a30-88c2628c56e0" class="">There are several criticisms of SSS.</p><ol id="50d86707-2cde-41f4-9c3a-662804658a55" class="numbered-list" start="1"><li><a href="https://en.bitcoin.it/wiki/Shamir_Secret_Snakeoil">Shamir Secret Snakeoil</a></li></ol><ol id="45f19f92-e7ac-4c4f-90d3-b8f516f72dd5" class="numbered-list" start="2"><li><a href="https://blog.keys.casa/shamirs-secret-sharing-security-shortcomings/">Shamir’s Secret Sharing Shortcomings</a></li></ol><p id="46f85a88-22dd-4be1-82fc-b4fd9e2ab657" class=""><a href="https://bitcoin.stackexchange.com/questions/102007/is-sharding-a-good-alternative-to-multisig">Sharding vs Multisig?</a></p><h1 id="4164f973-2f27-40ba-99df-ddecdcdf4c31" class="">Lightning Network</h1><p id="4df089a3-ec19-46b8-8fc6-497cb151efc2" class=""><em>Lightning Network and related off-chain protocols.</em></p><p id="7f6bc413-dfca-4875-b88f-f81a9c620024" class="">A few exceptional resources to get started:</p><p id="cd3c307c-06d9-4cb6-9800-294add7c35a7" class=""><a href="https://github.com/lnbook/lnbook">Master Lightning Book
</a><a href="http://dev.lightning.community/overview/">Lightning Overview
</a><a href="https://github.com/t-bast/lightning-docs">t-bast’s notes</a></p><p id="18c86e3a-94b1-419a-8071-ebd3d663e7fc" class="">Lightning Network is a scaling solution to keep most transactions off-chain while leveraging the security of the bitcoin chain as an arbitration layer. There are several concepts to review before jumping into the domain. We will start small by covering lightning primitives, then apply these primitives to describe the Lightning Network.</p><p id="a9d77d5d-42e3-488c-96e9-0385e1f41927" class="">Payments channels is a construct between two parties that commit funds and pay each other by updating a balance redeemable by either party. Moving funds between each part is near instant. Channels have a total capacity that is established by the on-chain funding transaction. Additionally, each party in the channel has their own balance. For example, a channel between Alice and Bob can have a 1 BTC capacity, but 30% of the bitcoin is owned by Bob. For Alice, this means that her local_balance is 0.7 BTC while the remote_balance (Bob’s balance) is 0.3 BTC.</p><p id="5db433a4-b70f-4146-96ec-9572166dfe0f" class="">To create the payment channel construction, a funding transaction is created on-chain. Any updates to the channel involves updating the commitment transaction.</p><p id="a92f28ae-b641-4337-8111-305a775f145c" class="">Hash Time-Locked Contracts (HTLCs) allow transactions to be sent between parties who do not have a direct channels by routing it through multiple hops, so anyone connected to the Lightning Network is part of a single, interconnected global financial system.</p><p id="fac4da4e-7c99-4bb1-9c52-1f23abf6a69e" class="">Payment channels are the main workhorse of the Lightning Network. They allow multiple transactions to be aggregated into just a few on-chain transactions. In the vast majority of cases, someone only needs to broadcast the first and last transaction in the channel.</p><ul id="110dea7f-38e9-423e-a994-e3a93e9ab493" class="bulleted-list"><li>The Funding Transaction creates the channel. During this stage, funds are sent into a multisig address controlled by both Alice and Bob, the counterparties to the channel. This address can be funded as a single-payer channel or by both Alice and Bob.</li></ul><ul id="c23e018e-e856-46e4-bee0-ae865e12b1b8" class="bulleted-list"><li>The Closing Transaction closes the channel. When broadcast, the multisig address spends the funds back to Alice and Bob according to their agreed-upon channel amount.</li></ul><p id="069fb141-4c07-4fe2-88f7-a3f94648c2eb" class="">channel updates</p><ul id="b8609c59-3776-4b03-b61c-8ccb361ba599" class="bulleted-list"><li>In between the opening and closing transactions broadcast to the blockchain, Alice and Bob can create a near infinite number of intermediate closing transactions that gives different amounts to the two parties.</li></ul><ul id="b93709ad-e6f2-4955-a4d1-2577018cb912" class="bulleted-list"><li>For example, if the initial state of the channel credits both Alice and Bob with 5BTC out of the 10BTC total contained in the multisig address, Alice can make a 1BTC payment to Bob by updating the closing transaction to pay 4BTC/6BTC, where Alice is credited with 4BTC and Bob with 6BTC. Alice will give the signed transaction to Bob, which is equivalent to payment, because Bob can broadcast it at any time to claim his portion of the funds.<ul id="3b56d2da-d940-4d7d-a8db-4f6546deb58c" class="bulleted-list"><li>To prevent an attack where Alice voids her payment by broadcasting the initial state of 5BTC/5BTC, there needs to be a way to revoke prior closing transactions. Payment revocation roughly works like the following.</li></ul><ul id="0643e8f8-8950-4a64-8d9b-17ac63303e77" class="bulleted-list"><li>Alice must wait 3 days after broadcasting the closing transaction before she can redeem her funds. During this time, Bob is given a chance to reveal a secret that will allow him to sweep Alice’s funds immediately. Alice can thus revoke her claim to the money in some state by giving Bob the secret to the closing transaction. This allows Bob to take all of Alice’s money, but only if Alice attest to this old state by broadcasting the corresponding closing transaction to the blockchain.</li></ul></li></ul><p id="a5f1abed-472c-4ee9-8449-c48b4f32e076" class="">Payment channels &amp; revocable transactions<a href="https://paychan.github.io/bitcoin-payment-channels-taxonomy/">great graphical overview</a></p><p id="000ef421-3b98-43ef-ab0b-d9c003801473" class="">txn:
Bob’s signature and a relative timelock (Bob’s spend branch); or
Alice’s signature and a secret revocation hash provided by Bob (Alice’s revocation branch).</p><p id="0eb26e66-7c5e-4daf-881a-8a871dde6b99" class="">usually have multiple utxos. Once bob reveals his secret, alice can collect her spend TXO and rTXO.</p><p id="30990b6e-ad8d-4723-b402-12f4c3996564" class="">revocable transaction script_pub_key:
OP_IF # Bob’s spend branch - after the revocation timeout duration, Bob can spend with just his signature OP_CHECKSEQUENCEVERIFY OP_DROP
&lt;Bob’s public key&gt;
OP_ELSE # Revocation branch - once the revocation pre-image is revealed, Alice can spend immediately with her signature
OP_HASH160 &lt;h(rev)&gt; OP_EQUALVERIFY OP_DROP
&lt;Alice’s public key&gt;
OP_ENDIF
OP_CHECKSIG</p><p id="2b65b1e5-a345-40e8-b26b-233a6d4573ec" class="">recovcation keys used base points and blinding key. similar to bip32, keys derived using base key.</p><p id="258b0986-14b0-455c-8ae3-b67405fe5c1a" class=""><a href="https://rusty.ozlabs.org/?p=450">revocable transactions</a><a href="https://rusty.ozlabs.org/?p=462">HTLCs</a></p><p id="18d3487d-9bf0-44ce-99dc-4dbee35f7b3f" class=""><a href="https://docs.google.com/presentation/d/1TyF0W3cZbkz4SyZG9qY7Is2pytC1GwSvs9KRKmYblFk/edit#slide=id.p">enterprise lightning presentation</a></p><h2 id="78ad6867-3235-4f9c-ad2f-6009bc706fc6" class="">BOLTs</h2><p id="d6251a0a-3de4-4c4f-bec1-111135fabf6b" class=""><a href="https://www.youtube.com/watch?v=Ysj2yobFMF4">great overview of BOLT by Jim Posen
</a><a href="https://www.youtube.com/watch?v=toarjBSPFqI">how onion routing works with HTLCs
</a><a href="https://commons.wikimedia.org/wiki/File:Introduction_to_the_Lightning_Network_Protocol_and_the_Basics_of_Lightning_Technology_(BOLT_aka_Lightning-rfc).pdf">presentation by Rene</a></p><p id="245aab43-ebc3-4c84-833e-4966eb348d46" class="">BOLT is the Basics of Lightning Technology.</p><p id="c66fcf48-c00d-4112-a794-1c89bb251f3a" class="">The BOLT repo found <a href="https://github.com/lightningnetwork/lightning-rfc">here</a> describes the specification for the Lightning Network.</p><ol id="9a7d6726-782f-4b7c-b23e-1972823828b3" class="numbered-list" start="1"><li>BOLT #0<p id="54f9719c-8220-406d-a687-890db0853602" class="">Provides a basic glossary defining terminology that is used throughout the rest of the specification.</p></li></ol><ol id="c3ee8e91-3289-4335-b5a2-58da2a793b71" class="numbered-list" start="2"><li>BOLT #1<p id="f58b3918-baf7-4d98-83c3-d6f89aa4f78c" class="">Describes the base message protocol including the TLV format and the setup messages.</p><p id="96307f6c-8419-487f-8e8c-b8a7a85f35e2" class="">TLV is Type-Length-Value.</p><p id="bf22ec6d-edff-402e-ad83-c85d077250e6" class="">Funny enough, the unicode code point for lightning is 0x2607. In decimal, 9735 which is also the default TCP port.</p></li></ol><ol id="73044bdf-4798-457c-9bfd-b88b64bb5896" class="numbered-list" start="3"><li>BOLT #2<p id="2820c7e7-a4a7-4d19-8c69-253610b65576" class="">Contains peer channel protocol lifecycle.</p><p id="818df5ae-292a-4bcb-830e-b8a2a784363b" class="">A channel_id is used to identify a channel. channel_id = XOR(funding_txid, funding_output_index)</p><p id="cda63e08-b46a-4931-8bb7-ce8344c29530" class="">Before a channel is created, a temporary_channel_id is used which acts a nonce. This nonce is local and can be duplicate across the rest of the protocol.</p><ol id="ef14e4e1-8ad6-4d7d-a196-7c222bbc931f" class="numbered-list" start="1"><li>Channel Establishment</li></ol><ol id="e7ea5aa7-a600-4051-9289-315199a74924" class="numbered-list" start="2"><li>Channel Close</li></ol><ol id="014cf6eb-000e-469a-a292-6fcf7eeb7b37" class="numbered-list" start="3"><li>Normal Operation<p id="90855876-9bb2-4a2e-8993-357fc5f1026f" class="">Once both nodes have exchanged funding_locked, the channel is used to make payments with HTLCs.</p></li></ol></li></ol><ol id="e7bc4a18-54c0-47dd-8c79-f329fa753ce1" class="numbered-list" start="4"><li>BOLT #3<p id="310cb17e-a750-49e1-8f21-efe7adcf1628" class="">Describes transaction and script formats.</p></li></ol><ol id="4ac4844a-c30e-4807-a436-6c3e34b3f5a9" class="numbered-list" start="5"><li>BOLT #4</li></ol><ol id="3640882a-1de4-4f96-8296-420172616596" class="numbered-list" start="6"><li>BOLT #5<p id="3a35cc4d-f599-40e9-9d2f-3cccc33d46b1" class="">Channels can end with a mutual close, unilateral close, or a revoked transaction close.</p><p id="42a9bccc-8682-4d6a-8f15-2cafc7054e74" class="">In a mutual close, local and remote nodes agree to close. They generate a closing transaction.</p><p id="f3918fe5-597d-45cd-a845-51695a3fa52b" class="">In a unilateral close, one side publishes its latest commitment transaction.</p><p id="87b9e89b-bafb-49bd-be5f-2f9ab2b19e29" class="">In a revoked transaction close, one party is cheating and publishes an oudated commitment transaction.</p><p id="97216795-c007-4453-9aeb-bab4cda709ca" class="">A commitment transaction has up to six types of outputs:</p><ol id="fc824e0f-f063-490e-b1d6-b2d6a0d1e9f6" class="numbered-list" start="1"><li>local node’s main output: Zero or one output, to pay to the local node’s delayed_pubkey.</li></ol><ol id="3213251f-bcb6-45f4-b96b-8d08feee1682" class="numbered-list" start="2"><li>remote node’s main output: Zero or one output, to pay to the remote node’s delayed_pubkey.</li></ol><ol id="16438378-cb53-467d-9561-af02d04bf9ca" class="numbered-list" start="3"><li>local node’s anchor output: one output paying to the local node’s funding_pubkey.</li></ol><ol id="0f3bb8ba-791b-45d3-b1f7-36919609c21a" class="numbered-list" start="4"><li>remote node’s anchor output: one output paying to the remote node’s funding_pubkey.</li></ol><ol id="d85fcfc4-5367-4b78-9c1a-494a61272335" class="numbered-list" start="5"><li>local node’s offered HTLCs: Zero or more pending payments (HTLCs), to pay the remote node in return for a payment preimage.</li></ol><ol id="de593a7a-767d-4070-9836-fc943cc74b54" class="numbered-list" start="6"><li>remote node’s offered HTLCs: Zero or more pending payments (HTLCs), to pay the local node in return for a payment preimage.</li></ol><p id="30255fce-4753-4710-8d06-c45043acfb3a" class="">If the local node publishes its commitment transaction, it will have to wait to claim its own funds, whereas the remote node will have immediate access to its own funds.</p></li></ol><ol id="c3d7988d-0ca8-498d-a080-aeef5e115b00" class="numbered-list" start="7"><li>BOLT #7<p id="9e0ccd65-c639-43e2-a284-5163b5dea954" class="">P2P</p></li></ol><ol id="a74db812-a11a-4a22-9022-601c3a20900f" class="numbered-list" start="8"><li>BOLT #8</li></ol><ol id="14ec18b0-467d-4e8a-91f9-3717f7f963cb" class="numbered-list" start="9"><li>BOLT #9</li></ol><ol id="e1c141e7-a405-45cb-98d6-e3fe8002bb98" class="numbered-list" start="10"><li>BOLT #10</li></ol><ol id="5ca1aa19-e2de-492d-aad5-ad4358aa0e2f" class="numbered-list" start="11"><li>BOLT #11<p id="613e7aac-eaac-49e3-a5fa-df3e97d250cf" class="">Invoice spec.</p></li></ol><ol id="ab9100bc-e953-476b-ab9e-ef128236efa0" class="numbered-list" start="12"><li>WIP: BOLT #12<p id="3c34990d-b48b-432a-abd8-3a1b59890e62" class="">BOLT 12 describes a new invoice format and flow called Offers.</p><p id="113c779b-1eef-4f8e-9a8e-b5d80db84a77" class="">The Draft of the PR can be found <a href="https://github.com/lightningnetwork/lightning-rfc/pull/798">here</a>.</p><p id="de373839-d21a-4d50-8aee-cfb8518a1c4b" class="">The flow described is the following:</p><ol id="3eea07ae-7679-4023-bc20-04627d204ca0" class="numbered-list" start="1"><li>Receiver publishes an offer.</li></ol><ol id="1e7f26d5-cf87-4493-a3b7-9bfe92652e08" class="numbered-list" start="2"><li>Payer requests a new unique invoice over LN using the offer.</li></ol><ol id="d8bc8396-351f-4853-80ad-3dda6387ff02" class="numbered-list" start="3"><li>Receiver responds with a unique invoice.</li></ol><ol id="00fc9c2f-442a-4a94-a495-5957694fae0d" class="numbered-list" start="4"><li>Payer pays the invoice.</li></ol><p id="a4e1c611-4894-43ae-bcee-8d0ce9d139af" class="">There are a number of improvements over BOLT11.</p><p id="c00a6a2d-acfe-4e77-a3e0-d2b8c225a8eb" class="">Payment proof is designed to allow the payer to prove that they were the unique payer.</p><p id="2539f9eb-f309-4067-9dda-4dce8758b2eb" class="">Merkle tree is used to be able to prove only specific fields of the invoice, not the enture invoice!</p><p id="bace47dc-5c5c-4788-b28b-c751e49dc5b6" class="">Some offers are periodic, meaning that payments are expected on a recurring period. This allows for new applications that require subscription-based payments.</p></li></ol><h2 id="d391f30a-f29e-4e7d-a6be-52fa459050dc" class="">Implementations</h2><p id="ca3dd9bb-c750-41cc-a5ef-0b1fe075c4b7" class="">There are several implementations following the BOLT specification.</p><ol id="5a71dd4f-b550-40d0-8f65-b99a1a00af8d" class="numbered-list" start="1"><li>LND<p id="8c1a7e17-e28b-4d3c-ab01-3befaa618e1f" class=""><a href="http://diyhpl.us/wiki/transcripts/sf-bitcoin-meetup/2018-04-20-laolu-osuntokun-exploring-lnd0.4/">Exploring LND 0.4
</a><a href="http://diyhpl.us/wiki/transcripts/sf-bitcoin-meetup/2019-05-02-conner-fromknecht-lnd-0.6-beta/">LND 0.6-Beta</a></p></li></ol><h2 id="2ca5b469-a85e-40d4-9fa1-8c43938ec837" class="">anecdotal example</h2><p id="cc0fc808-9e58-47cd-b020-e4722e529d9d" class="">Suppose Alice has a channel with Bob, who has a channel with Carol, who has a channel with Dave: A&lt;-&gt;B&lt;-&gt;C&lt;-&gt;D. How can Alice pay Dave?
Alice first notifies Dave that she wants to send him some money.
In order for Dave to accept this payment, he must generate a random number R. He keeps R secret, but hashes it and gives the hash H to Alice.</p><p id="72f52288-ba5b-468b-83fc-0bf743f6aaeb" class="">Alice tells Bob: “I will pay you if you can produce the preimage of H within 3 days.” In particular, she signs a transaction where for the first three days after it is broadcast, only Bob can redeem it with knowledge of R, and afterwards it is redeemable only by Alice. This transaction is called a Hash Time-Locked Contract (HTLC) and allows Alice to make a conditional promise to Bob while ensuring that her funds will not be accidentally burned if Bob never learns what R is. She gives this signed transaction to Bob, but neither of them broadcast it, because they are expecting to clear it out later.
Bob, knowing that he can pull funds from Alice if he knows R, now has no issue telling Carol: “I will pay you if you can produce the preimage of H within 2 days.”
Carol does the same, making an HTLC that will pay Dave if Dave can produce R within 1 day. However, Dave does in fact know R. Because Dave is able to pull the desired amount from Carol, Dave can consider the payment from Alice completed. Now, he has no problem telling R to Carol and Bob so that they are able to collect their funds as well.</p><p id="b6d45a45-26cd-4732-a528-0f58412eeeca" class="">Alice knows that Bob can pull funds from her since he has R, so she tells Bob: “I’ll pay you, regardless of R, and in doing so we’ll terminate the HTLC so we can forget about R.” Bob does the same with Carol, and Carol with Dave.</p><p id="ead202de-589b-494c-a838-913923ea348a" class="">Now, what if Dave is uncooperative and refuses to give R to Bob and Carol? Note that Dave must broadcast the transaction from Carol within 1 day, and in doing so must reveal R in order to redeem the funds. Bob and Carol can simply look at the blockchain to determine what R is and settle off-chain as well.</p><h2 id="fb08e8d6-8c7a-4a98-8c64-bc01071d5d9a" class="">Lightning Conf 2019 Berlin</h2><p id="b4fd2e99-cc01-450c-bdfc-373336ef2684" class=""><a href="https://www.electrum.org/talks/lightning/presentation.html#slide1">electrum slides on lightning</a>
Circular routes: send to self.
Suggestions</p><ul id="442d7aa2-2039-420c-997e-6ef41cd512a9" class="bulleted-list"><li>do not accept random peers</li></ul><ul id="4f0e7b98-6332-45d7-b3df-fa6800ba8d25" class="bulleted-list"><li>disallow invoices to blacklisted pubkeys</li></ul><p id="603b860b-5ad3-433b-8760-13104026715f" class="">Command line tools</p><ul id="77173390-4edc-405d-a6ae-ac6a5867158d" class="bulleted-list"><li>LNDmanage by @bitromortac</li></ul><ul id="dbf41dcd-685a-4d53-a543-50ce62daa02c" class="bulleted-list"><li>Balance of Satoshis by @alexbosworth</li></ul><ul id="edda81c2-24c6-4456-9a2f-62b7b2a9b322" class="bulleted-list"><li>Rebalance-LND by @C-Otto</li></ul><p id="6f14400f-67af-49e2-b997-e9aab550a5a6" class="">Make Me an Offer (Bolt 12) introduced.</p><p id="6b881ae2-e425-4e25-bce9-1e9567044697" class="">LSAT</p><ul id="be7c62c4-22fd-402c-b12f-1e175664c559" class="bulleted-list"><li>Macaroon - cryptographic bearer credential</li></ul><ul id="d257d3c2-2a7f-4943-b16a-52bd94381ab7" class="bulleted-list"><li>Delegation possible</li></ul><ul id="17f34b20-ddca-4000-bfc2-55d50f659279" class="bulleted-list"><li>Chained HMAC construction<ul id="3b6ae1d7-cc6c-4ec9-aab7-5dfe72b50ded" class="bulleted-list"><li>Secret root used to derive all others</li></ul></li></ul><ul id="a4ef5f2c-250a-4178-8a69-7b9c1b89be26" class="bulleted-list"><li>Fine grained permission</li></ul><p id="52d7efda-e753-4872-9313-94c2ebb8fbe6" class="">Hedging the Chain</p><ul id="91eff1ff-323f-42b8-a9c2-dfb2b31bc7df" class="bulleted-list"><li>Bitcoin fee market</li></ul><ul id="62a3b442-c006-4389-8a28-fc15820c8d51" class="bulleted-list"><li>“Every biz using the blockchain is inherently short blockchain fees”</li></ul><ul id="a5bbbaa6-eee2-4388-84f0-23abff1dd2e8" class="bulleted-list"><li>Derivatives traditionally used as a hedge</li></ul><ul id="7fd108fe-8b52-43f7-bcdd-fb329c50ffef" class="bulleted-list"><li>Corn farmers inherently long corn</li></ul><ul id="c67e63c4-9d0b-4a8f-974f-755dcf0e5794" class="bulleted-list"><li>They short corn futures as a hedge</li></ul><p id="5318abd1-898e-4cbb-b7d3-540e648073c0" class="">Liquidity</p><ul id="bb1ef200-02ca-4c5b-b982-f0339571fe90" class="bulleted-list"><li>No pairwise trades</li></ul><ul id="821afe13-35ec-4a6d-8b87-5bf007d57055" class="bulleted-list"><li>different sources of liquidity is not the same</li></ul><ul id="37c2f425-aea9-4379-897c-228ee243cdfe" class="bulleted-list"><li>Set outbound liquidity to the same fee</li></ul><ul id="1af95e41-f6f7-47e3-b64b-60f006b9d19a" class="bulleted-list"><li>Varied inbound liquidity</li></ul><ul id="5c1acda3-d080-4896-b9e5-a05d5078c60b" class="bulleted-list"><li>Make liquidity a pairwise market</li></ul><ul id="2d3e5ec9-646e-4866-9ae3-e1dc409a97b6" class="bulleted-list"><li>External settlement mechanisms</li></ul><ul id="a47d6e1e-2834-4765-b9e8-f18e2be1804d" class="bulleted-list"><li>Circular rebalancing</li></ul><p id="763bf182-b6bd-4ff6-aabe-6110d5a088c8" class="">Attacks</p><ul id="20fdf9a5-3026-4149-83c2-c858c0c0b588" class="bulleted-list"><li>Set min chan size …too many channels causes performance issues</li></ul><ul id="5099f469-8cd9-4fc3-bd41-458ea4b9faa1" class="bulleted-list"><li>Create a bunch of hold invoices and drain balance</li></ul><ul id="ec5c3486-9f44-45fd-9da8-12a1bad3c9f3" class="bulleted-list"><li>Stealing free fees, someone sets up intermediate node between invoice and collects fees.</li></ul><p id="ff6f46e1-c88d-4400-8d29-220800f1bcdc" class=""><a href="http://diyhpl.us/wiki/transcripts/stanford-blockchain-conference/2019/htlcs-considered-harmful/">htlcs are harmful</a></p><h2 id="934a5090-e785-43ad-a057-904335285bc4" class="">Discrete Log Contracts</h2><p id="509ef75c-a7fa-44b4-b04d-490fa4b90a1b" class=""><a href="https://medium.com/@gertjaap/discreet-log-contracts-invisible-smart-contracts-on-the-bitcoin-blockchain-cc8afbdbf0db">intro</a></p><h2 id="edd3ad2e-56c3-400c-9b3b-7037ec46e980" class="">Security</h2><p id="25dde1fd-1d17-4af2-ba48-89db6e56a922" class=""><a href="https://medium.com/@devrandom/securing-lightning-nodes-39410747734b">securing lightning nodes by devrandom</a><a href="https://gitlab.com/lightning-signer">link to the lightning-signer project on GitLab</a><a href="https://suredbits.com/lightning-101-for-exchanges-security-part-3-private-key-management/">key mgmt</a></p><p id="6d053ccf-c2df-4ba7-b421-df4fe6b6d697" class=""><a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2020-June/002735.html">blackmail attack</a></p><ol id="49a17354-a433-4077-a602-cd6e58fd2610" class="numbered-list" start="1"><li>LSAT<p id="9bc76505-e610-4a82-ae93-6d092da3fe1c" class="">Lightning Service Authentication Token<a href="https://docs.google.com/presentation/d/1QSm8tQs35-ZGf7a7a2pvFlSduH3mzvMgQaf-06Jjaow">lsat talk</a></p><p id="9a51a935-f5e9-4466-b6fe-241feac7ed5d" class="">using macaroon based bearer API credential with lightning network payment</p></li></ol><ol id="001c761f-46ad-491f-b906-431270a23d84" class="numbered-list" start="2"><li>Key management<p id="f297836c-c3d0-4461-9c9d-13dc72370fcb" class=""><em>Overview of each key in the channel lifecycle.</em></p><p id="f0a2a8f5-f498-46e2-980b-cc745d8cb4da" class=""><a href="https://docs.google.com/presentation/d/1_-FF0U2AXuhBxEzW9J_IrYxvRi1SS2MYwJl0QeIcqbI">talk on key mgmt</a>
need onchain hot wallet to open channels (only need once)</p><p id="cf7f1420-6856-424f-ad28-ebb81517cb0f" class="">1 of 2 keys must be hot for the funding transaction.
If counterparty gets key, funds are lossed. If 3rd party gets it, they must collude.</p><p id="3b95bf18-ef26-465d-b079-edf43b1cc0b9" class="">Commitment secret: must be hot.
Used to generate “local_pubkey” and “remote_pubkey”
Used to derive subsequent secrets and public keys.
If leaked, peer can steal all money in commitment txn.</p><p id="b174a617-1b3b-42d3-a0e6-9aecf3dcc478" class="">Revocation basepoint secret: can be cold.
Used to claim peer funds if they try to cheat.
Can be cold if accessible before “to_self_delay”</p><p id="eba0cabd-a99e-4546-8a93-802b6921a6fa" class="">If your counterparty gets access to this key, they can claim their funds in their to_local output immediately by circumventing the locktime</p><p id="57f2942b-efe4-4018-993a-102f92200aac" class="">Payment basepoint secret: claim money from the “to_remote” output on peer commitment txn.
can be cold
if peer gets access to this key, all funds can be taken in the “to_remote”.</p><p id="165eeaec-2c77-411b-89db-387c2173b34e" class="">Delayed Payment Basepoint Secret: claim money on “to_local” output of commitment txn. can be cold.</p><p id="96436b5b-d481-481b-8a80-748d84cde9ec" class="">HTLC Basepoint Secret: secret needed to sign for HTLCs. must be hot.</p><p id="6a490115-624f-4ae9-b5b5-193e7f2f4ae3" class="">hosted channels<a href="https://gist.github.com/btcontract/d4122a79911eef2620f16b3dfe2850a8">gist on hosted channels</a>
interesting idea but need to look more into security assumptions..</p></li></ol><h2 id="9ca19ba3-849a-4949-8cf5-404b6ad8ed94" class="">Privacy</h2><p id="d77d4f95-58a8-4bd4-8a76-d2d45a621710" class=""><a href="https://arxiv.org/abs/2003.12470">An Empirical Analysis of Privacy in the Lightning Network</a></p><h2 id="cf9563b0-5163-45d6-96dd-460dcdb6aa9b" class="">Routing</h2><p id="20b41f3a-2297-46ee-b3e6-d0526d5f6aa3" class="">Routing involves routing a lightning payment through either a public or private channel.</p><p id="8e373031-6cff-43c9-a97b-260550f10632" class="">Routing is generally constructed for a specified payment amount.
Other considerations, however, includes value of open channels, decision to make new channels, re-balancing decisions, multi-path payments or multi-part payments (MMP, formerly AMP).</p><p id="844c2480-6be7-4652-907e-f8b4f05a690a" class=""><a href="https://medium.com/coinmonks/amount-independent-payment-routing-in-lightning-networks-6409201ff5ed">amount independent routing</a></p><p id="46457127-a22f-4c96-a3be-931dbe5f8443" class="">One of problem in routing is payment privacy. Two proposals to increase the privacy of paymnet senders and recipients are rendevous routing and route blinding.</p><ol id="31865238-1821-4cc8-9a18-20dd4dc1a303" class="numbered-list" start="1"><li>Rendezvous Routing<p id="26d3a67c-505f-43f9-a4cd-9f34926f34be" class="">Rendevous routing is a <a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2018-November/001498.html">proposal</a> aimed to protect the privacy of payments on the lightning network. In the initial proposal, an argument is made that private channels should not be revealed to payers. The solution is to have the payee choose one or more routes from certain third-party nodes on the public network to himself, and pass sphinx-encryped blogs for those routes to the payer. Then, the payer complets the route by finding routes from himself to the selected third-party nodes.</p><p id="61eaf15f-27b9-4bdb-bca4-e083492cf1b5" class=""><a href="https://github.com/lightningnetwork/lightning-rfc/wiki/Rendez-vous-mechanism-on-top-of-Sphinx">Rendezvous mechanism on top of sphinx</a></p></li></ol><ol id="fa3a1a55-812a-4e92-8e9c-959f5226d688" class="numbered-list" start="2"><li>Route Blinding<p id="501e223e-e7ec-4d9b-8790-b625f19247ee" class="">Route Blinding is currently a <a href="https://github.com/lightningnetwork/lightning-rfc/blob/route-blinding/proposals/route-blinding.md">proposal</a> that aims to provide recipient anonymity by blinding an arbitrary amount of hops at the end of an onion path. Like rendezvous routing, this proposal is aimed and hiding the final portion of the route from the sender. The recipient chooses an “introduction point” and a route to himself from that point. The recipient blinds each node and channel for that route with ECDH. This blinded route and a hop-binding secret are included in the invoice.</p></li></ol><ol id="d05218df-a2a3-4978-b44c-7b12c55471ae" class="numbered-list" start="3"><li>Upfront Payments<p id="0f2a1fd1-1531-47bd-80a6-515102b7fbd8" class="">Jamming attacks are possible where an attack can delay a payment resolution and therefore lock bitcoin along a route for a period of time. This attack is described <a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2015-August/000135.html">here</a>.</p><p id="73eae581-fc94-4ced-abe2-3346494a16c4" class="">Fidelity Bonds are a solution to</p></li></ol><h2 id="d9fec0d4-46ab-4634-ac1c-507a3b5a7a40" class="">Payments</h2><h3 id="3b98c12c-454f-4c6e-95d8-2ea818225fb2" class="">Atomic Multi-path Payments (AMP)</h3><p id="100f1425-a7d4-440d-bd09-90b0acdfbb22" class=""><a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2018-February/000993.html">Mailing List Discussion</a></p><p id="d956047b-f15f-40ec-aeae-589b6eab7af1" class="">Atomic multi-path payments allow a single logical payment to be sharded across multiple paths across the network. This is done at the sender side. Multiple subtransactions can be sent over the network and take their own paths and then the necessary constraint is that they all settle together. If one of the payments fails then we want them to all fail. This is where the atomicity comes in. This enables better usage of in-bound and out-bound liquidity. You can send payments over multiple routes, and this allows you to split up and use the network better. This is a more intuitive user experience because like a bitcoin wallet you expect to be able to send most of the money in your wallet. Without AMPs, this is difficult because you can only send a max amount based on current channel liquidity or something, which doesn&#x27;t really make sense to a user.</p><p id="96ee13b2-3c61-4d6a-af25-93cfff86412a" class="">Only the sender and receiver need to be aware of this technology.</p><h3 id="fbdef6d1-d18e-48e4-91a4-30eb0ff3b36c" class="">Splicing</h3><p id="13c55c46-9e1c-4e90-b676-297ad059d622" class=""><a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2017-May/000692.html">Mailing List Discussion</a></p><p id="f73e443b-e4d0-44d6-b5d5-433440a93576" class="">With a splice-in, funds can be added to the channel, and they subsume an existing UTXO. And splice-out can remove funds from a participant balance and this creates a UTXO. You can take what&#x27;s in the channel, splice it off to an address that a person I&#x27;m trying to pay controls.</p><p id="cc1d454b-415d-4090-99dd-32f5cd557ee6" class="">This removes the concept of my &quot;funds are locked in the lightning network&quot; because now you can do both on-chain payments into a channel and you can also do a payment out of a channel without interrupting the normal operation of the channel.</p><h3 id="e8122b54-152b-4449-951b-84886a61a09e" class="">Submarine Swap</h3><p id="53081f58-7e51-4f0a-812b-87ce18b78196" class=""><a href="https://www.youtube.com/watch?v=ASkyu0w_8Q8">SF Bitcoin Devs Talk on Submarine Swaps</a></p><p id="09dd15e5-ac7a-4696-9a76-f0611af36d5c" class="">Submarine swaps allow you to pay someone on-chain and have the payment to them be contingent on them paying a Lightning invoice you give them. If they don&#x27;t pay the invoice, after a timeout you can get your money back.</p><h3 id="e6e5f788-a391-4c95-bba5-827bd6341635" class="">Hold Invoices</h3><p id="1fba94b6-4cbe-40e1-832b-991f4e65e2be" class=""><a href="https://github.com/lightningnetwork/lnd/pull/2022">LND implementation</a></p><p id="1b2fe5cc-d4d5-4d90-b440-002c8a3a6b3e" class="">Instead of immediately locking in and settling the htlc when the payment arrives, the htlc for a hold invoice is only locked in and not yet settled. At that point, it is not possible anymore for the sender to revoke the payment, but the receiver still can choose whether to settle or cancel the htlc and invoice.</p><h3 id="88cec45e-21f8-4f81-b238-e5a38362f14f" class="">Trampoline Payments</h3><p id="31fbd331-8910-4c30-abb3-6305fba5442c" class="">Lightning network currently relies on source routing where sender calculates the route. Sender needs to maintain graph state.</p><p id="298f5c49-b1a4-4e79-831b-3f0a4d2b6576" class="">Trampoline payments is a new suggested way of outsourcing that aims at having lite clients outsourcing the route computation to trampoline nodes, nodes of higher Memory, bandwidth and computation power.</p><p id="106fc0c0-e012-42f5-b779-9e23fbb09768" class=""><a href="https://bitcointechweekly.com/front/outsourcing-route-computation-with-trampoline-payments/">design decisions on trampoline routing</a></p><h3 id="b6b048fe-68df-44d7-b2c8-08fd3eff4ad4" class="">Static/Send/Spontaneous/Push Payments</h3><p id="8f956ec9-5d7f-45ad-a1e1-9a920e8089ca" class="">Wow, lots of names for an overlapping concept.</p><p id="37395a91-0970-4b31-9cc9-92864a685a64" class=""><a href="https://github.com/lightningnetwork/lightning-rfc/pull/798">OffersStatic Payments</a><a href="https://github.com/lightningnetwork/lightning-rfc/issues/644">Push Invoices</a></p><h2 id="6666bd59-ae08-4a68-b0d9-18e1af2a74d2" class="">HTLCs</h2><p id="df071e01-409c-4363-9873-b52ba38b414b" class="">HTLCs..Hashed Time Lock Contracts.</p><p id="0ea17c91-af45-4f66-a580-f7f8284387ac" class="">The initiator of a Lightning channel pays the closing fee. Lots of HTLCs = large fee. See <a href="https://twitter.com/joostjgr/status/1310584596174643200">thread</a>.</p><p id="95d8e799-d3ef-472c-aca5-66f42fedcdca" class=""><a href="https://twitter.com/joostjgr/status/1311608861955158019">Thread on free HTLC forwarding</a></p><p id="955e3c8f-7691-4f72-a1b4-ab3fd2593755" class="">An interesting idea to handling the edge cases around HTLCs is to have a firewall. An <a href="https://github.com/lightningequipment/circuitbreaker">example</a>.</p><h2 id="3485ed65-a52c-44d3-b18f-6269440417dd" class="">PTLCs</h2><p id="5f5d7c54-b504-4817-9b14-2f9300792ccf" class="">Payment Points<a href="https://suredbits.com/payment-points-and-barrier-escrows/">excellent SuredBits blog on PTLCs</a></p><h2 id="2761c42e-2858-4e20-ab0b-23195e647c88" class="">Future</h2><p id="fd7fdf4c-8a48-411b-a645-dfc5db5270f1" class=""><a href="https://blog.theabacus.io/lightning-network-2-0-b878b9bb356e">challenges and opportunites for ln 2</a></p><p id="05394d1c-8c49-42c2-b667-be5bc26b60d9" class=""><a href="https://medium.com/@antoine.riard/why-we-may-fail-lightning-ee3692de1a55">Why We Fail Lightning</a></p><h2 id="0a685c5c-6a52-4cd2-b3ef-e50ca28e1f40" class="">Operations</h2><p id="669872b6-c844-4165-a5a7-e9595e892417" class="">The challenges of operating a lightning node deserves its own section. The lightning domain is distinct from on-chain bitcoin due to its own security assumptions, state changes, and end-user experience.</p><p id="35d32ba1-7003-4a95-b342-832788a6bf41" class="">The most immediate concern is backup maintance. With on-chain bitcoin, one can is familiar with BIP39 mnemonic seed phrases as the ultimate backup for bitcoin. In lightning, the backup file is responsible for channels. Do <strong>not</strong> take backups of channel state itself. Inaccurate or revoked channel state is can lead to a justice transaction and punishment (loss of all funds in the channel). As a result, backups are tricky in lightning.</p><p id="067f9939-e63e-4292-a190-d4ecf6db295c" class="">Static channel backups (SCBs) are the best backups for lightning node operators. The backups are called static because they are only obtained once - when the channel is created. Afterwards, the backup is valid until the channel is closed. A SCB allows a node operator to recover funds that are fully settled in a channel. Fully settled funds are bitcoin in commitment outputs, but not HLTCS.</p><p id="a50b1867-ba5e-4303-9603-c4a2ed01721d" class=""><a href="https://github.com/lightningnetwork/lnd/blob/master/docs/recovery.md">LND Recovery Documentation</a><a href="https://github.com/lightningnetwork/lnd/pull/2313">LND PR#2313</a><a href="https://gist.github.com/alexbosworth/2c5e185aedbdac45a03655b709e255a3">Automating channel backups for LND</a><a href="https://api.lightning.community/#subscribechannelbackups">Subscribe to channel backups for LND</a></p><p id="ba752841-b8ce-4935-a8d8-4206020077c7" class="">In addition to backups, channel management is a large area of focus. A node operator wants to be connected to reliable and honest peers. Factors to consider are uptime, balance, and cost of rebalancing. It is convenient to create a list of decent nodes and maintain a relationship with them. For inbound liquidity, swaps can be used or swap services like Lightning Labs Loop. Loop can be used to refill channels. Managing incoming channel requests can be important in order to prevent undesirable peers. For example, setting a threshold for channel capacity can prevent dust limit problems in the future. It is better to have fewer channels that are well capitalized than many channels with poor capacity.</p><p id="805f781a-5bf7-4333-9185-f26d0c105250" class="">Watchtowers can be used to monitor private nodes.</p><h2 id="8667342d-58cb-4078-ad55-7ce644969659" class="">Limitations</h2><h1 id="0f7882f3-7cfc-4d28-a618-13b2351ea099" class="">Privacy</h1><p id="16e9e97f-58ec-4bb0-8612-a418ea70b8d9" class=""><em>Privacy and techniques used in chain-analysis.</em></p><p id="6a255d01-59bb-46db-bbe1-bb9d85fa1f21" class=""><a href="https://en.bitcoin.it/wiki/Privacy">Privacy Wiki</a></p><p id="1cde53cd-470e-4b2f-a9b2-ee2255a5e0dc" class=""><a href="https://www.youtube.com/watch?v=peT_9XF2L04">snowball presentation at ldn bitdevs</a></p><p id="a07d39a4-2de2-4ad9-b5fb-2af9b48ae8fb" class="">common input hueristic: “different public keys used as inputs to a transaction as being controlled by the same user”<a href="https://cseweb.ucsd.edu/~smeiklejohn/files/imc13.pdf">original paper on blockchain analysis</a></p><p id="773e178a-ced6-4b2d-95d6-6aac239f3ebc" class=""><a href="https://github.com/6102bitcoin/CoinJoin-Research">coin join wiki</a></p><p id="4864df48-916e-4360-b158-3085807702d5" class=""><a href="https://bitcoin.stackexchange.com/questions/101868/is-there-something-about-bitcoin-that-prevents-us-from-implementing-the-same-pri">Bitcoin vs “privacy coins”</a></p><h2 id="90b5c3fb-b8a5-490d-8a81-115c93a7b9d4" class="">CoinJoins</h2><p id="c34793ae-baef-489e-8795-e5c5272690db" class="">“So a world where”basically everyone uses CoinJoin&quot; is cool for privacy, but could end up pretty bad for scalability, because these transactions are in addition to the normal payments.&quot; - waxwing</p><ol id="a4628650-41da-41d9-81de-35586c0e23c7" class="numbered-list" start="1"><li>PayJoin<p id="6decea2e-b8b4-4faa-8929-cca0e4401b68" class=""><a href="https://joinmarket.me/blog/blog/payjoin/">payjoin by waxwing</a>
PayJoin is coinjoin + payment</p><p id="d987fcdc-cba0-41ad-b77b-a0fe357560ad" class="">“Let Bob do a CoinJoin with his customer Alice - he’ll provide at least one utxo as input, and that/those utxos will be consumed, meaning that in net, he will have no more utxos after the transaction than before, and an obfuscation of ownership of the inputs will have happened without it looking different from an ordinary payment.”</p><p id="7eb599b4-f5c5-4b46-9285-4118e4a758b4" class="">“the main point is with PayJoin - we break the heuristic without flagging to the external observer that the breakage has occurred.” … unlike coinjoins</p><p id="247dd1c9-3dce-4f0a-bbe9-9313047e9df4" class="">“snowball effect” … payjoin/p2ep reduces utxo set and receiver’s utxo gets bigger after each payment txn.</p><p id="5a8110e9-b569-4b26-bec8-d79da54aeeaf" class="">who pays for the fee?
“every payment to the merchant creates a utxo, and every one of those must be paid for in fees when consumed in some transaction.”</p><p id="861b96c8-2c84-4261-bdd8-8f415511a567" class="">real world implementation is <a href="https://samouraiwallet.com/stowaway">samourai wallet</a></p><p id="ef7f0326-f52e-4f14-af7f-8b8866c28153" class=""><a href="https://gist.github.com/AdamISZ/4551b947789d3216bacfcb7af25e029e">join market</a></p></li></ol><ol id="7a002bc3-fed3-4c41-844f-078badc1a269" class="numbered-list" start="2"><li>Pay To EndPoint (P2EP)<p id="0a84b251-2a11-4257-92b4-be43a776cc8b" class=""><a href="https://blockstream.com/2018/08/08/en-improving-privacy-using-pay-to-endpoint/">p2ep blockstream</a>
“The basic premise of P2EP is that both Sender and Receiver contribute inputs to a transaction via interactions coordinated by an endpoint the Receiver presents using a BIP 21 compliant URI.”</p><p id="b43c936e-f151-468b-8572-1bdeb26b922f" class="">Steps:</p><ol id="bbe14830-2291-4206-b7a6-6e3d473e3447" class="numbered-list" start="1"><li>Receiver generates a BIP 21 formatted URI with an additional parameter that specifies their P2EP endpoint.</li></ol><ol id="2167923f-df12-4032-b728-a63f33161d8e" class="numbered-list" start="2"><li>The Sender initiates interaction with the Receiver by confirming that the endpoint provided is available. If not, the transaction is broadcast normally, paying to the Receiver’s BIP 21 regular Bitcoin address. If the Receiver’s endpoint is available, the Sender provides a signed transaction to the Receiver as proof of UTXO ownership.</li></ol><ol id="992917c4-96ab-4e81-9cba-d2cf9f017067" class="numbered-list" start="3"><li>The Receiver then sends a number of transactions to the Sender for them to sign. Out of these transactions, only one includes a UTXO that is actually the owned by the Receiver, the rest can be selected from the pool of spendable UTXOs.</li></ol><ol id="b97a7cee-8f1a-4a46-8f4b-8b48c18e8469" class="numbered-list" start="4"><li>Receiver obtains a signed transaction that corresponds to their UTXO they can sign and broadcast the transaction, which will now contain inputs from both the Sender and the Receiver.</li></ol><p id="6bde9f5d-348c-4762-9164-5c94d2f20c92" class="">Example:
If Alice wants to pay Bob 1 BTC:</p><ol id="e3a73c07-dea6-4cce-9877-766a98f980a4" class="numbered-list" start="1"><li>Alice inputs 3 BTC to a transaction.</li></ol><ol id="7a7e4ab2-f5c9-47b9-bfa5-f07d8d30e67f" class="numbered-list" start="2"><li>Bob inputs 5 BTC to the same transaction.</li></ol><ol id="ee319c88-12a7-403c-a5d7-8fb1a8549490" class="numbered-list" start="3"><li>Alice receives 2 BTC (as her change).</li></ol><ol id="299d2b06-df8f-49f9-bd51-7ba256421e4e" class="numbered-list" start="4"><li>Bob receives 6 BTC (as his change, plus the 1 BTC payment from Alice).</li></ol><p id="a45e7fcb-83f5-4457-8af1-531223abae2b" class="">Disadvantages:
Receiver and Sender must be online. Interactive.
More Cons/Pros listed in blogpost.</p></li></ol><h2 id="82e8fb6d-35ec-422d-b78e-1023153f11dc" class="">BIP-79</h2><p id="26f5e32a-9652-421a-98d8-9bc08291f9a5" class=""><a href="https://github.com/bitcoin/bips/blob/master/bip-0079.mediawiki">link to bip</a></p><h2 id="f10d2921-5057-43e0-b799-afee706cf651" class="">CoinSwaps</h2><p id="099d6f6b-078d-48dd-b49b-45019ac4177a" class=""><a href="https://bitcointalk.org/index.php?topic=321228.0">maxwell on coinswaps</a><a href="https://joinmarket.me/blog/blog/coinswaps/">waxwing on coinswaps</a></p><p id="2ee6228e-16e6-4864-befa-2407ee68e544" class="">“We can use a cryptographic commitment scheme to create atomicity that binds two, independent Bitcoin transactions”</p><p id="e817f2b3-ef63-40f7-bedf-328ac0603eb8" class="">Make a random x, hash it. Make a p2sh output that is spendable with proving hash(x) is hash in scriptpubkey and pubkey owns output.</p><p id="c2b047c0-92c9-44e4-b22f-85ebe2bdbd01" class="">Other party can see x and then solve for their p2sh with their pubkey.</p><p id="29a5441c-028a-475d-b22d-4e7ce1aa6476" class=""><a href="https://github.com/AdamISZ/CoinSwapCS/issues/25#issuecomment-311281096">great explainer on cross-chain swaps</a></p><p id="ac5da15c-98ef-4263-be32-95661dda297e" class="">problem here is that x is revealed and a connection exists between both parties.</p><p id="530334d4-6f51-420c-9cff-a78293a45737" class="">HTLCs with presigned transactions can help avoid revealing x.<a href="https://en.bitcoin.it/wiki/Hash_Time_Locked_Contracts">htlcs wiki</a></p><p id="317b7129-e4e8-4392-8bbf-2b5567d3c059" class="">“An advantage of Coinswap over Coinjoin is a potentially bigger anonymity set (a lot more could be said)”</p><p id="ee18b842-5c25-44cf-ba3b-cf5d82370f3b" class=""><a href="https://github.com/AdamISZ/CoinSwapCS/blob/master/docs/coinswap_new.pdf">visual guide</a></p><p id="dcd2090c-cf77-4ebc-a777-664bfa667b82" class=""><a href="https://github.com/AdamISZ/CoinSwapCS">implementation</a></p><p id="32771172-94f4-4edd-a478-d6f112585828" class=""><a href="https://gist.github.com/chris-belcher/9144bd57a91c194e332fb5ca371d0964#design-for-a-coinswap-implementation-for-massively-improving-bitcoin-privacy-and-fungibility">new coinswap implementation</a></p><h2 id="84601db0-0345-4c34-991b-d9027dab506c" class="">TumbleBit</h2><p id="cf00098e-f2b2-4695-aee1-4b20f087fee3" class=""><a href="https://joinmarket.me/blog/blog/tumblebit-for-the-tumble-curious/">waxwing on tumblebit</a><a href="https://eprint.iacr.org/2016/575">original paper</a></p><p id="6aa02ab5-9c0e-41f7-b77b-089738a7cceb" class="">“A blind signature is allows a central authority to sign data which is hidden from them”</p><p id="d26a1ec5-73fe-4bbc-bfb3-0f790a892f3d" class="">“Chaumian cash” is a central mint authorised to blind-sign transfers of this cash</p><p id="9252a899-e7c4-4220-9e32-20518f1ad4a8" class="">&quot; At a very high level, it’s using commitments - I promise to have X data, by passing over a hashed or encrypted version, but I’m not yet giving it to you - and interactivity - two-way messaging, in particular allowing commitments to occur in both directions.&quot;</p><p id="339ff050-bac0-4ec6-8a0c-7b11495ff505" class=""><a href="https://en.wikipedia.org/wiki/Blind_signature">blind signatures</a></p><h2 id="f4bdd9da-c8fe-437c-be88-09db193dc723" class="">SNICKER</h2><p id="ba69dad1-6a10-4676-8d07-68a04fe989f4" class=""><a href="https://gist.github.com/AdamISZ/2c13fb5819bd469ca318156e2cf25d79">link to bip</a></p><p id="cb2f60e0-f9ab-4fb7-ae14-6f2c6ca4605a" class="">SNICKER (Simple Non-Interactive Coinjoin with Keys for Encryption Reused)</p><p id="38e5568c-ed77-4608-abd5-8cdca3740648" class="">allowing the creation of a two party coinjoin without any synchronisation or interaction between the participants.</p><h2 id="8b3926e5-832f-4773-b734-a89bf3a7cf5c" class="">PaySwap</h2><p id="991d96c8-6ec3-469c-abd0-461cdf336c1f" class=""><a href="https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2020-January/017595.html">dev mailing list</a></p><h2 id="abd2ea2c-909a-43f6-808f-54756c51741f" class="">More Cryptography</h2><ol id="83113cda-3713-4d15-b739-cec11050ac5d" class="numbered-list" start="1"><li>Adaptor Signatures<p id="c31b723a-e62b-49eb-9fdb-b06debdb9c8d" class=""><a href="https://github.com/ElementsProject/scriptless-scripts/blob/master/md/atomic-swap.md">explainer using atomic swaps</a>
“An”adaptor signature&quot; is a not a full, valid signature on a message with your key, but functions as a kind of “promise” that a signature you agree to publish will reveal a secret, or equivalently, allows creation of a valid signature on your key for anyone possessing that secret.&quot;</p></li></ol><ol id="62c4c8d7-e0a6-4846-a6f2-b1f9b5a4941c" class="numbered-list" start="2"><li>Schnorr<p id="916a753b-f092-4a83-a611-8ae561b378b7" class=""><a href="https://joinmarket.me/blog/blog/liars-cheats-scammers-and-the-schnorr-signature/">waxwing on schnorr sigs</a><a href="https://joinmarket.me/blog/blog/flipping-the-scriptless-script-on-schnorr/">scriptless scripts and schnorr</a></p><p id="9ddf26da-877f-4d50-8ddf-9fcb7b329580" class=""><a href="https://joinmarket.me/blog/blog/multiparty-s6/">multiparty schnorr coinshuffle</a></p></li></ol><ol id="7cb41d27-bcd9-4b20-8b30-741b599848fd" class="numbered-list" start="3"><li>Ring Signatures<p id="55e3ea6c-b814-4660-aaf3-b615d2c97c46" class=""><a href="https://joinmarket.me/blog/blog/ring-sig">waxwing on ring sigs</a></p></li></ol><h2 id="e167a3a9-c683-4853-8ae9-3fe3697b240e" class="">Chain Analysis</h2><p id="abdf2025-ebda-4f68-932a-0e6f199db55b" class="">Peel chains are strings of transactions commonly used for money laundering, in which entities send funds through several wallets in quick succession, usually breaking off small amounts to cash out at each step and sending the majority on to the next wallet.</p><h1 id="68962683-8c96-4d80-8a0e-46cd7885ce27" class="">Security</h1><p id="d5ea2558-9e03-4cce-b9c3-17705464d8c8" class=""><em>Security related information.</em></p><p id="bb13e5da-439d-4c23-9b98-28b813464585" class=""><a href="https://www.youtube.com/watch?v=UDbl-2gk7n0">Everything is Broken</a></p><p id="b2d96682-c148-4e3d-aff5-18e683adfe39" class=""><a href="https://blog.bitmex.com/build-systems-security-bitcoin-is-improving/">Bitcoin is Improving</a></p><p id="9325e3e5-e522-4700-a5b9-687276d4647c" class=""><a href="https://link.springer.com/chapter/10.1007/978-3-030-00470-5_29">Identifying Key Leakage in Bitcoin</a></p><h2 id="7fdd82e3-863e-40a7-bbf8-6de29a22ae69" class="">Hardware Wallets</h2><p id="472c5058-f55f-454e-82c9-60b10f7d8fe6" class=""><a href="https://thecharlatan.github.io/List-Of-Hardware-Wallet-Hacks/">List of Hardware Wallet Hacks</a></p><p id="e7ae3df8-4497-4fb4-b2f3-120f846940c3" class=""><a href="https://shiftcrypto.ch/blog/remote-multisig-theft-attack-on-the-coldcard-hardware-wallet/">Remote MultiSig Theft Attack on Coldcard</a><a href="https://medium.com/blockstream/anti-exfil-stopping-key-exfiltration-589f02facc2e">Key Exfiltration</a></p><h2 id="e6ba1361-57f9-4bf6-929f-5ba8f0a100e0" class="">Mining</h2><p id="bd913366-7893-4260-8c42-66d458dc1af7" class="">Selfish mining attack is when a miner withholds a valid and worked block, and begin mining the next block. The miner has an edge over the network if they withhold the block and attempt to work on the next block.</p><h1 id="20775e10-a153-4cca-a4f9-df58f4535753" class="">Bitcoin Core</h1><p id="a29247a2-8f04-455a-b9fa-98df68d0af0f" class=""><em>Notes on Bitcoin Core architecture and development.</em></p><h2 id="506a6702-7348-47d0-89dc-0115a6fbc885" class="">Debugging</h2><p id="fc1125b9-6f7b-4300-bd36-dd44dc71b8b7" class=""><a href="https://gist.github.com/fjahr/2cd23ad743a2ddfd4eed957274beca0f">debug wiki</a></p><p id="76ff1b92-ee1e-4db3-a8e8-3c871350cfdd" class="">LogPrintf(&quot;&quot;)
cat debug.log | grep @@@</p><p id="1aee182a-7941-49fd-abcb-a022a137bb54" class="">lldb src/bitcoind</p><p id="9d5fac70-e4cb-4cb3-b392-11d0f5c958a0" class="">unit tests in src/test/ using BOOST lib test framework.</p><p id="9eeb5789-0234-4983-beef-68ee4935984f" class="">Run just one test file: src/test/test_bitcoin –log_level=all –run_test=getarg_tests
Run just one test: src/test/test_bitcoin –log_level=all –run_test=*/the_one_test</p><p id="69052837-a676-46b1-8593-3fae5b83a97a" class="">Logging from unit tests…
BOOST_TEST_MESSAGE(“@@@”);</p><p id="a6c6e56c-c2c4-41de-8106-41bb14a31a6e" class="">functional tests in test/functional using python
–loglevel=debug
self.log.debug(“bar”)</p><p id="628e4950-fb21-487a-b5b9-c9ddd2bd0318" class="">Use –tracerpc to see the log outputs from the RPCs of the different nodes running in the functional test in std::out.</p><p id="edd75c9f-f8b3-4c0e-9e9e-9f88dae45a00" class=""><a href="https://github.com/bitcoin/bitcoin/blob/master/test/README.md">on tests</a><a href="https://github.com/bitcoin/bitcoin/blob/master/src/test/README.md">on unit tests</a><a href="https://github.com/bitcoin/bitcoin/blob/master/test/functional/README.md">on functional tests</a></p><p id="09ffe637-b9ae-465e-a686-f89e2696de58" class=""><a href="https://github.com/fanquake/core-review">core review tools</a></p><h2 id="24df961f-e563-434c-860d-89457aa81cde" class="">Architecture</h2><p id="577a9b2b-c1f9-40c7-a547-a678a2305145" class=""><a href="https://jameso.be/dev++2018/#1">overview of arch</a></p><h2 id="50d67092-4617-41fe-9f22-a22fedfae291" class="">Wallet</h2><p id="ec4c14d7-a454-4bcb-8aaf-fa20e3acfcbb" class=""><a href="https://residency.chaincode.com/presentations/bitcoin/Wallet_Development.pdf">wallet dev presentation by John Newbery</a>
CPubKey - a public key, used to verify signatures. A point on the secp256k1 curve.
CKey - an encapsulated private key. Used to sign data.
CKeyID - a key identifier, which is the RIPEMD160(SHA256(pubkey))
CTxDestination - a txout script template with a specific destination. Stored as a varint variable</p><ul id="ed1c63f0-bba3-4806-b7c1-ee07e2ad4469" class="bulleted-list"><li>CNoDestination: no destination set</li></ul><ul id="4fec3a52-fd9d-45d5-b9bd-4a04a9d8ef59" class="bulleted-list"><li>CKeyID: P2PKH</li></ul><ul id="109eeba0-0a38-4b29-bc45-f05b33676982" class="bulleted-list"><li>CScriptID: P2SH</li></ul><ul id="1d29a1ab-8f93-4cc0-a53b-6f8e5cc2ece6" class="bulleted-list"><li>WitnessV0ScriptHash</li></ul><ul id="b81f97e2-95e2-4a40-a90b-339e77ddcb88" class="bulleted-list"><li>WitnessV0KeyHash</li></ul><ul id="74e94019-8102-4a5c-bf32-1c768525bd8b" class="bulleted-list"><li>WitnessUnknown</li></ul><p id="7c594241-adac-4628-ad31-542a40f0e5d7" class="">Wallet component is intialized through the WalletInitInterface.
For builds with wallet, the interface is overrridden in src/wallet/init.cpp</p><p id="684e59e5-d06a-4866-98c6-627a8e699394" class="">For –disable-wallet, there is DummyWalletInit</p><p id="694ebf2e-6c3c-4f2d-8e42-1a75772a4eca" class="">initiation interface methods are called during node initialization</p><p id="7741dd3f-1ae4-4b02-86d2-c1f3c4c1097c" class="">During loading… WalletInit::Construct() adds a client interface to the wallet.
Node then tells wallet to load/start/stop/etc through the ChainClient interface in src/interfaces/wallet.cpp
Most methods in that interface call through to functions in src/wallet/load.cpp</p><p id="548ab662-1eaa-45cb-991d-97c0e4116bfa" class="">Node &lt;&gt; Wallet Interface
Node holds a WAlletImpl interface to call functions on the wallet.
Wallet holds a ChainImpl interface to call functions on the node.
Notifications handler
Node notifies the wallet about new transactions and blocks through the CValidationInterface</p><p id="ae066f38-3ad4-4a92-9edd-7d0720251de0" class="">Identifying Transactions
When a transaction is added to the mempool or block is “connected”, the wallet is notified through CValidationInterface.
SyncTransaction() … calls AddToWalletIfInvolvingMe()
IsMine() : takes the scriptPubKey, interprets it as a Destination type, and then checks whether we have the key(s) to watch/spend.</p><p id="f172beb8-7d36-41f2-823e-1d4155fcf670" class="">Generate Keys
Originally a collection of unrelated private keys.
Keypools introduced in 2010 by Satoshi. Cache 100 private keys. When a new key is needed, draw it from keypool and refresh.
HD wallets introduced to Bitcoin Core in 2016. Keypool essentially became an address lock-ahead pool. It is used to implement a ‘gap limit’.</p><p id="9ab672c1-b00a-4822-ae18-539434723250" class="">Constructing Transactions
sendtoaddress
sendtomany
{create,fund,sign,send}rawtransaction
The address is decoded into a CDestination.
Other parameters can be added for finer control (RBF, fees, etc).
Wallet creates the transaction in CreateTransaction().</p><p id="c8192599-1379-42da-b9e6-293c920466ee" class="">Coin Selection
By default, coin selection is automatic.
Logic starts in CWallet:SelectCoins().
By preference, we choose coins with more confirmations.
Manual coin selection (coin control) is possible in CCoinControl.</p><p id="05bd80cf-7e33-43ef-89f8-e437ca801fbc" class="">Signing Inputs
Last step in CreateTransaction()
CWallet is an implementation of SigningProvider interface.
Signing logic for the SigningProvider is all in src/script/sign.cpp.</p><p id="f2ddff47-f367-4180-8316-80072b5ba9c1" class="">Sending Transactions
Wallet saves and broadcats the wallet in CommitTransaction()
submitToMemoryPool(), relayTransaction()</p><h1 id="4f95ce1d-67f1-460d-9e8d-f717bd3e3396" class="">History</h1><p id="c0197a7a-5730-4816-b5d1-bd3fbe81ec1c" class=""><em>Bitcoin history and misc. trivia items.</em></p><p id="4b14b06d-a6b1-43d6-be50-a464fe3372bb" class=""><a href="https://queue.acm.org/detail.cfm?id=3136559">Bitcoin’s Academic Pedigree</a></p><p id="7a49a5b7-fd19-44e8-aa7a-4edbdf181f4f" class=""><a href="https://b10c.me/blog/004-the-incomplete-history-of-bitcoin-development/">b10c’s Incomplete History of Bitcoin Development</a></p><p id="17d5eec0-0616-45ec-93de-23cbe26c6bc0" class=""><a href="https://bitcoinmagazine.com/articles/long-road-segwit-how-bitcoins-biggest-protocol-upgrade-became-reality">History of segwit activation</a></p><p id="f187918a-665a-42a1-9f1d-5370e8cb82d7" class=""><a href="https://bitcoinmagazine.com/articles/the-battle-for-p2sh-the-untold-story-of-the-first-bitcoin-war">History of P2SH</a></p><h1 id="740b96f8-ae5f-46c5-bb50-1aebacc4192f" class="">Other</h1><p id="5dfb6ca8-1210-4cfe-8eff-bd5d3abeff15" class=""><em>Notes that do not fit neatly in the other categories.</em></p><p id="efb13ddc-b9ba-45a0-90f6-42f655c503cf" class="">Merkelized Abstract Syntax Trees are a general concept: when bitcoin developers talk about it, they’re talking about reworking bitcoin scripts into a series of “OR” branches, and instead of the output committing to the whole script, you commit to the head of the tree.  To spend it, you only need to provide the branch of the script you’re using, and the hashes of the other branches. This can improve privacy, and also shrink the total size of large scripts, particularly if there’s a short, common case, and a long, complex rare case. Note that each key is 33 bytes and each signature about 72 bytes, and each merkle branch only 32 bytes.</p><p id="13a66f14-fc58-4221-b837-250589607eda" class="">Sidechains are based on cross-chain consensus validation through SPV and reorganization proofs (an idea that dates back to my P2PTradeX protocol), while drivechains are based on miners being consensus proxies.</p><p id="1faceb79-0dcf-4bd3-a709-a86e6dd2a218" class="">The idea behind JoinMarket is to help create a special kind of bitcoin transaction called a CoinJoin transaction. It’s aim is to improve the confidentiality and privacy of bitcoin transactions, as well as improve the capacity of the blockchain therefore reduce costs. The concept has enormous potential, but had not seen much usage despite the multiple projects that implement it. This is probably because the incentive structure was not right.
A CoinJoin transaction requires other people to take part. The right resources (coins) have to be in the right place, at the right time, in the right quantity. This isn’t a software or tech problem, its an economic problem. JoinMarket works by creating a new kind of market that would allocate these resources in the best way.</p><p id="8475b6ee-5263-4762-afc2-fbe027fe221d" class="">Merged mining is the act of using work done on another block chain (the Parent) on one or more Auxiliary block chains and to accept it as valid on its own chain, using Auxiliary Proof-of-Work (AuxPoW), which is the relationship between two block chains for one to trust the other’s work as their own. The Parent block chain does not need to be aware of the AuxPoW logic as blocks submitted to it are still valid blocks.</p><h2 id="12c20179-6e1f-4767-9b37-c8971ce744a2" class="">Future directions of bitcoin</h2><p id="7dba261f-673e-43c8-af11-7cd699d72fd4" class=""><a href="http://diyhpl.us/wiki/transcripts/2018-01-24-rusty-russell-future-bitcoin-tech-directions/">transcript</a>
Schnorr Signature Scheme</p><ul id="12db6708-6e10-4f5f-8798-bdf7ef39bc25" class="bulleted-list"><li>Has security proof, EDCSA does not.</li></ul><ul id="cd4eb227-00f3-45eb-867b-01be04e6e837" class="bulleted-list"><li>Has linear property, sum of sigs is sum of keys.</li></ul><p id="c2a21827-dfbc-4c36-b457-b70705a414be" class="">SIGHASH_NOINPUT - sign scripts, not txid</p><p id="e67cc89d-97c2-4f7f-b9a6-2de93cbc34f7" class="">Taproot
basic idea-&gt; tweak pubkey Q = P+H(P,S)G
Q in output
key spend sign(Q)
script spend: P,S, inputs</p><p id="36071ef7-a18b-4e06-beb6-e10fefc2f522" class="">Graftroot
if a key exists to represent everyone
use delegation instead of merkle tree
inherently interactive key setup</p><h2 id="1ff04b0b-af3e-4bdf-8ca3-b6f5e25a1cdc" class="">Utreexo</h2><p id="087e1043-73cc-40d2-aaa6-bce6b56240ff" class=""><a href="http://diyhpl.us/wiki/transcripts/bitcoin-core-dev-tech/2018-10-08-utxo-accumulators-and-utreexo/">accumulators</a></p><h2 id="ead4058a-ede2-4c04-8093-1ef9c95bd64b" class="">Graftroof</h2><p id="c1abfa1e-1fb1-4532-bd16-1fbe6b517bcd" class="">The idea of graftroot is that in every contract there is a superset of people that can spend the money.
In graftroot, if all the participants agree, then they can just spend. So they can do pubkey aggregation on P</p><p id="720c081d-b08a-4918-89a7-8191ad44a73c" class="">Taproot: P = c + H(c || script) G</p><p id="646fdffb-683d-4633-9261-f5b0a589619f" class="">Graftroot: sigp(script)</p><p id="b715eeb0-f6e3-47d4-ab54-c630c998c912" class=""><a href="http://diyhpl.us/wiki/transcripts/bitcoin-core-dev-tech/2018-03-06-taproot-graftroot-etc/">graftroot vs taproot</a></p><h2 id="82436512-8310-4207-8985-51303994ecf6" class="">AssumeUTXO</h2><p id="769c7a0d-6169-464f-88ce-9867013041da" class="">You get a serialized UTXO set snapshot obtained by a peer. This all hinges on a content-based hash of the UTXO set. The peer gets headers chain, ensures base of snapshot in chain, load snapshot. They want to verify the base of the snapshot or the blockhash is in the header chain. We load the snapshot which deserializes a bunch of coins and loads it into memory. Then we fake a blockchain; we have a chainstate but no blocks on disk, so it’s almost like a big pruned chain. We then validate that the hash of the UTXO set matches what we expected through some hardcoded assumeutxo. This is a compiled parameter value, it can’t be specified at runtime by the user which is very important. At that point, we sync the tip and that will be a similar delta to what assumevalid would be now, maybe more frequent because that would be nice. Crucially, we start background verification using a separate chainstate where we do regular initial block download, bnackfill that up to the base of the snapshot, and we compare that to the hash of the start of the snapshot and we verify that.<a href="http://diyhpl.us/wiki/transcripts/bitcoin-core-dev-tech/2019-06-07-assumeutxo/">talk on assumeutxo</a></p><p id="0ee1e86c-21cc-4dab-837f-64566224feee" class=""><a href="https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2019-April/016825.html">bitcoin-dev email</a></p><p id="1940c37e-b34d-4b6b-9405-fbec5f59fde5" class="">The initializing node syncs the headers chain from the network, then obtains and loads one of these UTXO snapshots (i.e. a serialized version of the UTXO set bundled with the block header indicating its “base” and some other metadata).</p><p id="cfa632f8-7395-467a-bcdf-c4e796060147" class="">hardcoded hashs exist in software ..hash(utxoset). similar to assumevalid.</p><p id="65de408c-1400-492f-abfe-8fa4bd3c4643" class="">snapshots can obtained in same manner as block download. Doesn’t matter about source cuz of content hash.</p><h2 id="a0d6074f-9045-4d45-a07a-5db2e1b0bbf3" class="">CoinWitness</h2><p id="785bcaff-570a-4e94-adfb-844e98aa8e3a" class="">Applications of ZK Snarks… “. Instead of embedding the rules that govern an output inside the blockchain, you’d instead embed a proof that the rules were followed. Instead of everyone checking that a transaction was permitted to be spent, they’d instead check that you checked.” - Maxwell</p><p id="d5d9b0aa-1a2e-4ebe-a359-8753b528d313" class=""><a href="https://bitcointalk.org/index.php?topic=277389.0">coin witness</a></p><p id="369c3f21-a6be-4846-a0de-f3577968802e" class="">“You write down a small program which verifies the faithfulness of one of these transcripts for your chosen verifiable off-chain system. The program requires that the last transaction in the transcript is special in that it pays to a Bitcoin scrippubkey/p2sh. The same address must also be provided as a public input to the program. We call this program a”witness&quot; because it will witness the transcript and accept if and only if the transcript is valid.</p><p id="faf89569-50cd-4779-940c-2a8e082eb737" class="">You then use the SCIP proof system to convert the program into a verifying key. When someone wants to create a Bitcoin in an off-chain system, they pay that coin to the hash of that verifying key. People then transact in the off-chain system as they wish. To be confident that the system works faithfully they could repeat the computationally-expensive verifying key generation process to confirm that it corresponds to the transaction rules they are expecting.</p><p id="f7aba3d4-088d-4489-b776-6190cc92bcfc" class="">When a user of one of these coins wants to exit the system (to compact its history, to move to another system, to spend plain Bitcoins, or for any other reason), they form a final transaction paying to a Bitcoin address, and run the witness on their transcript under SCIP and produce a proof. They create a Bitcoin transaction redeeming the coin providing the proof in their script (but not the transcript, thats kept private), and the Bitcoin network validates the proof and the transaction output. The public learns nothing about the intermediate transactions, improving fungibility, but unlike other ideas which improve fungibility this idea has the potential to both improve Bitcoin’s scalability and securely integrate new and innovative alternative transaction methods and expand Bitcoin’s zero-trust nature to more types of transactions.&quot;</p><h2 id="6d2de0ef-f964-4ac4-8088-e668052d479e" class="">Covenants</h2><p id="37055fc3-1db2-48b4-95e8-73bed2bb989a" class="">A covenant in its most general sense and historical sense, is a solemn promise to engage in or refrain from a specified action.<a href="https://bitcointalk.org/index.php?topic=278122.0">maxwell on covenants</a></p><p id="55370e31-d50c-479a-bc13-36bec00970b0" class=""><a href="https://diyhpl.us/wiki/transcripts/scalingbitcoin/milan/covenants/">scaling bitcoin</a>
“Covenants can be recursively enforced down the chain for as long as you need to reinforce them.”</p><p id="e3f72cfe-a0f7-47e3-b83f-c9b5030e650e" class="">“Covenants can be used to break fungibility.”<a href="https://fc16.ifca.ai/bitcoin/papers/MES16.pdf">whitepaper</a></p><p id="35b26180-644d-4ba2-bdfe-eebe341c4c47" class=""><a href="https://arxiv.org/abs/2006.16714">Bitcoin Covenants: Three Ways to Control the Future</a></p><h2 id="75958c39-2491-4cf6-aa27-8f3c1d5215ef" class="">Zero Knowledge Contigent Payment</h2><p id="d84c250b-e5d5-482c-b1ef-cd9771adbfa9" class=""><a href="https://bitcoincore.org/en/2016/02/26/zero-knowledge-contingent-payments-announcement/">zero knowledge payment</a>
ZKCP</p><p id="a8e9ad8d-0473-484c-bf1c-265d5b586807" class="">swapping information for value</p><h2 id="03a91ead-ed13-4cad-b93d-f80abae9b266" class="">Discreet Log Contracts</h2><p id="b5fe00bb-58fd-482d-9219-ebdf4974c4c6" class=""><a href="https://adiabat.github.io/dlc.pdf">Whitepaper</a><a href="https://github.com/discreetlogcontracts/dlcspecs">DLC Spec</a></p><h1 id="89a26d28-3fcd-4330-953b-dd50b853461c" class="">Statistics</h1><p id="7aa1feb5-10e0-4861-a822-2608dbd17161" class=""><em>Analysis of the Bitcoin Blockchain.</em></p><p id="2e120391-2774-48a5-b87b-afd9fccb5814" class="">At this momement, the size of the Bitcoin Blockchain is 300 GB. Dating back to 2009, there is a trove of interesting data on how users have used and continue to use Bitcoin’s chain as a settlement layer. Monitoring the chain is useful exercise to detect trends, understand second-order affects from technical changes, and satisfy the data-curious.</p><p id="e8bcd07e-cfa2-4ebd-a32c-12f762c7e251" class=""><a href="https://txstats.com/dashboard/db/home-dashboard">TxStats - Latest stats on Bitcoin transaction types</a></p><p id="34a12a47-3fe6-481d-af6e-69d894cbf70d" class=""><a href="https://jochen-hoenicke.de/queue/">Johoe’s Bitcoin Mempool Statistics</a></p><p id="eba034e1-0ca7-438f-a8b5-7dc7d0c550ae" class=""><a href="https://dashboard.bitcoinops.org/d/TDhboADmk/bitcoin-optech-dashboards">Bitcoin Optech Dashboards</a></p><p id="37a32832-1ba3-4025-8af1-e2343daec0e0" class=""><a href="https://dsn.tm.kit.edu/bitcoin/">Bitcoin Monitoring - P2P</a></p><p id="972b07b6-195e-4ccf-93d7-b3be063d1ac6" class=""><a href="https://utxo-stats.com/">UTXO Stats</a></p><p id="8a3051f5-78d9-43e4-b9d8-a5ed5794ea64" class=""><a href="https://mempool.observer/">Mempool Observer</a></p><p id="c7f056be-4f23-4e1a-bf70-3f938c038cdd" class="">
</p></div></article></body></html>